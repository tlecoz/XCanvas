var Zt=Object.defineProperty;var $t=(Y,s,t)=>s in Y?Zt(Y,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):Y[s]=t;var n=(Y,s,t)=>$t(Y,typeof s!="symbol"?s+"":s,t);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();const P=class P{constructor(){n(this,"objects");n(this,"names");n(this,"indexByName");n(this,"objectById");n(this,"nbObject",0);n(this,"loadObjectsByID");if(!P._instance)P._instance=this,this.objects={},this.names=[],this.indexByName={},this.objectById=[],this.loadObjectsByID={};else throw new Error("ObjectLibrary is a singleton. You must use ObjectLibrary.instance")}registerObject(s,t){if(P.creatingObjectsAfterLoad)return"";let e,i;if(!this.objects[s])this.indexByName[s]=i=this.names.length,this.names.push(s),this.objects[s]={typeId:i,elements:[t]},e=0;else{var a=this.objects[s];i=a.typeId,e=a.elements.length,a.elements[e]=t}var r=i+"_"+e;return this.objectById[this.nbObject++]={type:i,ID:r,value:t},r}save(s="test.txt"){let t=this.names.join(",")+"[####]";const e=this.nbObject;let i,a;for(let c=0;c<e;c++)i=this.objectById[c],a=i.value.dataString,a!==""&&(c!==0&&(t+="[#]"),t+=i.ID+"[|]"+a);const r=new Blob([t],{type:"text/plain"}),h=URL.createObjectURL(r),l=document.createElement("a");l.href=h,l.download=s,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(h)}load(s,t){var e=this;this.loadObjectsByID=[],P.creatingObjectsAfterLoad=!0;var i=new XMLHttpRequest;i.open("GET","test.txt"),i.onreadystatechange=function(){if(i.readyState==4&&i.status==200){var a=i.responseText,r=a.split("[####]");e.names=r[0].split(",");var h,l=e.names.length;for(h=0;h<l;h++)e.objects[e.names[h]]={type:h,elements:[]};var c=r[1].split("[#]"),o,u,d,v,p,g;l=c.length;var x=[];for(h=0;h<l;h++)r=c[h].split("[|]"),v=r[0],u=v.split("_"),g=Number(u[0]),d=e.names[g],p=Number(u[1]),o=r[1],e.loadObjectsByID[v]=x[h]={className:d,instanceId:p,dataString:o};var _;for(h=0;h<l;h++)_=x[h],e.objects[_.className].elements[_.instanceId]=P.classes[_.className].fromDataString(_.dataString);P.creatingObjectsAfterLoad=!1,t&&t(i.responseText)}},i.send(null)}static get instance(){return P._instance||new P,P._instance}get dataTypes(){return this.names}getElementsByName(s){return this.objects[s].elements}getObjectByRegisterId(s){let t=s.split("_"),e=this.objects[this.names[Number(t[0])]].elements[Number(t[1])];if(e)return e;if(this.loadObjectsByID){let i=this.loadObjectsByID[s];if(i)return this.objects[i.className].elements[i.instanceId]=e=P.classes[i.className].fromDataString(i.dataString),e}return null}static print(){var s=P.instance,t=s.dataTypes,e,i=t.length;for(e=0;e<i;e++)t[e]}static printElements(s){var t=P.instance.getElementsByName(s),e,i=t.length;for(e=0;e<i;e++)console.log(e," => ",t[e])}};n(P,"classes"),n(P,"_instance"),n(P,"creatingObjectsAfterLoad",!1);let C=P;class q{constructor(){n(this,"___ID");this.___ID=C.instance.registerObject(this.constructor.name,this)}get REGISTER_ID(){return this.___ID}get dataString(){return""}}class Tt extends q{constructor(){super();n(this,"customData");n(this,"___dispatcherNames");n(this,"___nbDispatcher");n(this,"___dispatcherActifById");n(this,"___dispatcherFunctionById");this.customData={},this.___dispatcherNames=[],this.___nbDispatcher=0,this.___dispatcherActifById=[],this.___dispatcherFunctionById=[]}addEventListener(t,e,i=!1){if(!(t==null||e==null)){var a=this.___dispatcherNames.indexOf(t);a==-1&&(this.___dispatcherActifById[this.___nbDispatcher]=!1,this.___dispatcherFunctionById[this.___nbDispatcher]=[],a=this.___nbDispatcher,this.___dispatcherNames[this.___nbDispatcher++]=t),i?this.___dispatcherFunctionById[a]=[e]:this.___dispatcherFunctionById[a].push(e)}}clearEvents(){this.___dispatcherNames=[],this.___nbDispatcher=0,this.___dispatcherActifById=[],this.___dispatcherFunctionById=[]}removeEventListener(t,e){var i=this.___dispatcherNames.indexOf(t);if(i!=-1){if(!e){this.___dispatcherFunctionById[i]=[];return}var a=this.___dispatcherFunctionById[i],r=a.indexOf(e);r!=-1&&a.splice(r,1)}}applyEvents(t=null){var e=this.___dispatcherNames.length;if(e!=0){var i,a,r,h;for(i=0;i<e;i++)if(this.___dispatcherActifById[i]==!0)if(this.___dispatcherActifById[i]=!1,h=this.___dispatcherFunctionById[i],h)for(r=h.length,a=0;a<r;a++)h[a](this,t,this.___dispatcherNames[i]);else console.warn("EventDispatcher.applyEvents bug ? -> ",this.___dispatcherNames[i])}}dispatchEvent(t){if(this.___dispatcherNames){var e=this.___dispatcherNames.indexOf(t);e!=-1&&(this.___dispatcherActifById[e]=!0,this.applyEvents(this))}}}class Qt{constructor(s=0,t=0,e=0,i=0){n(this,"minX",999999);n(this,"minY",999999);n(this,"maxX",-999999);n(this,"maxY",-999999);this.init(s,t,e,i)}init(s=0,t=0,e=0,i=0){return this.minX=s,this.minY=t,this.maxX=e,this.maxY=i,this}get x(){return this.minX}set x(s){this.minX=s}get y(){return this.minY}set y(s){this.minY=s}get width(){return this.maxX-this.minX}set width(s){this.maxX=this.minX+s}get height(){return this.maxY-this.minY}set height(s){this.maxY=this.minY+s}clear(){this.x=this.y=this.width=this.height=0}draw(s){s.save(),s.strokeStyle="#000000",s.rect(this.minX,this.minY,this.maxX-this.minX,this.maxY-this.minY),s.stroke(),s.restore()}}const R=class R{constructor(){if(!R._instance){R._instance=this,R._canUseImageBitmap=createImageBitmap!=null&&createImageBitmap!=null,R._canUseWorker=Worker!=null&&Worker!=null,R._canUseOffscreenCanvas=window.OffscreenCanvas!=null&&window.OffscreenCanvas!=null;var s=document.createElement("canvas");s.width=s.height=1,createImageBitmap(s).then(t=>R.emptyImageBitmap=t)}}static get canUseImageBitmap(){return R._instance||new R,R._canUseImageBitmap}static get canUseWorker(){return R._instance||new R,R._canUseWorker}static get canUseOffscreenCanvas(){return R._instance||new R,R._canUseOffscreenCanvas}};n(R,"_canUseWorker",!1),n(R,"_canUseImageBitmap",!1),n(R,"_canUseOffscreenCanvas",!1),n(R,"_instance"),n(R,"emptyImageBitmap");let ut=R;const et=class et{constructor(){n(this,"pixelData");n(this,"w");n(this,"h");n(this,"id");if(et._instance)throw new Error("You must use BitmapPixel.instance");et._instance=this}static get instance(){return et._instance||new et,et._instance}init(s,t,e){return this.w=t,this.h=e,this.pixelData=s,this}getPixelObject(s,t){return this.id=(t*this.w+s)*4,this}setRGB(s,t,e,i,a){var r=(t*this.w+s)*4;this.pixelData[r++]=e,this.pixelData[r++]=i,this.pixelData[r++]=a,this.pixelData[r++]=255}setRGBA(s,t,e,i,a,r){var h=(t*this.w+s)*4;this.pixelData[h++]=e,this.pixelData[h++]=i,this.pixelData[h++]=a,this.pixelData[h++]=r}setSolidColorPixel(s,t,e){var i=(t*this.w+s)*4;this.pixelData[i++]=e.r,this.pixelData[i++]=e.g,this.pixelData[i++]=e.b,this.pixelData[i++]=e.a}copyIntoSolidColor(s,t,e){var i=(t*this.w+s)*4;e.r=this.pixelData[i++],e.b=this.pixelData[i++],e.g=this.pixelData[i++],e.a=this.pixelData[i++]}get r(){return this.pixelData[this.id]}get g(){return this.pixelData[this.id+1]}get b(){return this.pixelData[this.id+2]}get a(){return this.pixelData[this.id+3]}set r(s){this.pixelData[this.id]=s}set g(s){this.pixelData[this.id+1]=s}set b(s){this.pixelData[this.id+2]=s}set a(s){this.pixelData[this.id+3]=s}};n(et,"_instance");let Ht=et;const O=class O extends Tt{constructor(t=1,e=1,i=null){super();n(this,"offsetX",0);n(this,"offsetY",0);n(this,"pixel");n(this,"needsUpdate",!1);n(this,"_maskTemp",null);n(this,"_filterTemp",null);n(this,"_imageData",null);n(this,"pixels");n(this,"pixelDataDirty",!0);n(this,"useAlphaChannel");n(this,"sourceUrl",null);n(this,"_savedData");n(this,"ctx");n(this,"canvas");ut.canUseOffscreenCanvas?this.canvas=new window.OffscreenCanvas(t,e):this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.pixel=Ht.instance,i&&(this.ctx.fillStyle=i,this.ctx.fillRect(0,0,t,e))}get htmlCanvas(){return this.canvas}get context(){return this.ctx}saveData(){var t={data:this.ctx.getImageData(0,0,this.width,this.height),w:this.width,h:this.height};this._savedData=t}restoreData(t=!0){this._savedData&&(this.canvas.width=this._savedData.w,this.canvas.height=this._savedData.h,this.putImageData(this._savedData.data,0,0),t&&(this._savedData=null))}setPadding(t=0,e=0,i=0,a=0){var r=O.abstractCanvas,h=O.abstractContext;r.width=this.width,r.height=this.height,h.clearRect(0,0,this.width,this.height),h.drawImage(this.htmlCanvas,0,0),this.canvas.width=this.width+t+e,this.canvas.height=this.height+i+a,this.drawImage(r,t,i)}createImageBitmap(){return createImageBitmap(this.htmlCanvas,0,0,this.htmlCanvas.width,this.htmlCanvas.height)}get width(){return this.canvas.width}set width(t){this.canvas.width=t}get height(){return this.canvas.height}set height(t){this.canvas.height=t}getImageData(t,e,i,a){return this._imageData=this.ctx.getImageData(t,e,i,a),this._imageData}putImageData(t,e,i){this.ctx.putImageData(t,e,i)}drawDisplayElement(t,e=null){this.context.save(),e&&this.context.setTransform(e),t.renderStack.updateCache(this.context,t),this.context.restore()}drawHtmlCode(t,e,i,a,r){var h="<svg xmlns='http://www.w3.org/2000/svg' width='"+a+"' height='"+r+"'><foreignObject width='100%' height='100%'><div xmlns='http://www.w3.org/1999/xhtml'>"+t+"</div></foreignObject></svg>",l=self.URL||self,c=new Image,o=new Blob([h],{type:"image/svg+xml;charset=utf-8"}),u=l.createObjectURL(o),d=this.context;c.onload=function(){d.drawImage(c,e,i),l.revokeObjectURL(u)},c.src=u}clone(){var t=new O(this.width,this.height);return t.context.drawImage(this.htmlCanvas,0,0,this.width,this.height),t}resize(t,e,i=null){i||(i=this);var a=O.abstractCanvas,r=O.abstractContext;return a.width=t,a.height=e,r.clearRect(0,0,t,e),r.drawImage(this.htmlCanvas,0,0,this.width,this.height,0,0,t,e),i.width=t,i.height=e,i.clear(),i.context.drawImage(a,0,0,t,e),i}resizeWithAntialazing(t,e,i){if(i||(i=this),t>=i.width&&e>=i.height)return this.resize(t,e,i);var a=i.width,r=i.height,h=O.abstractCanvas,l=O.abstractContext;l.clearRect(0,0,h.width,h.height),h.width=a,h.height=r,l.drawImage(this.htmlCanvas,0,0);for(var c=0;a/2>t||r/2>e;)a/2>t&&(a/=2),r/2>e&&(r/=2),l.clearRect(0,0,h.width,h.height),h.width=a,h.height=r,c++==0?l.drawImage(this.htmlCanvas,0,0,this.width,this.height,0,0,a,r):l.drawImage(i.htmlCanvas,0,0,this.width,this.height,0,0,a,r),i.clear(),i.width=a,i.height=r,i.context.drawImage(h,0,0);return(t!=a||e!=r)&&(i.clear(),i.width=t,i.height=e,i.context.drawImage(h,0,0,h.width,h.height,0,0,t,e)),i}get pixelView(){return this._imageData||(this._imageData=this.context.getImageData(0,0,this.width,this.height)),this.pixel.init(this._imageData.data,this.width,this.height)}tint(t,e,i,a=1){var r=O.abstractCanvas,h=O.abstractContext;r.width!=this.width||r.height!=this.height?(r.width=this.width,r.height=this.height):h.clearRect(0,0,this.width,this.height),h.fillStyle="rgba("+t+","+e+","+i+","+a+")",h.fillRect(0,0,this.width,this.height),h.globalCompositeOperation="destination-atop",h.drawImage(this.htmlCanvas,0,0),this.context.clearRect(0,0,this.width,this.height),this.context.drawImage(r,0,0)}fillRect(t,e,i,a,r){this.context.fillStyle=r,this.context.fillRect(t,e,i,a),this.pixelDataDirty=!0}get pixelData(){return(!this._imageData||this.pixelDataDirty)&&(this._imageData=this.context.getImageData(0,0,this.width,this.height)),this.pixelDataDirty=!1,this.pixels=this._imageData.data,this.pixels}getPixels(t,e,i,a){return this.context.getImageData(t,e,i,a).data}getPixel(t,e){var i=(this.width*e+t)*4,a=this.pixelData,r=this.pixel;return r.r=a[i],r.g=a[i+1],r.b=a[i+2],r.a=a[i+3],r}getPixelRGBIntColor(t,e){var i=(this.width*e+t)*4,a=this.pixelData;return a[i]<<16|a[i+1]<<8|a[i+2]}getPixelRGBAIntColor(t,e){var i=(this.width*e+t)*4,a=this.pixelData;return a[i+3]<<24|a[i]<<16|a[i+1]<<8|a[i+2]}getPixelRed(t,e){return this.pixelData[(this.width*e+t)*4]}getPixelGreen(t,e){return this.pixelData[(this.width*e+t)*4+1]}getPixelBlue(t,e){return this.pixelData[(this.width*e+t)*4+2]}getPixelAlpha(t,e){return this.pixelData[(this.width*e+t)*4+3]}clear(){this.context.clearRect(0,0,this.width,this.height)}applyFilter(t){this.context.filter=t,this.context.drawImage(this.htmlCanvas,0,0),this.context.filter=""}drawImage(t,e=0,i=0,a=-1,r=-1,h=0,l=0,c=-1,o=-1){a==-1&&(a=t.width,r=t.height),c==-1&&(c=a,o=r),this.context.drawImage(t,e,i,a,r,h,l,c,o),this.pixelDataDirty=!0}setImageData(t,e,i){this._imageData=t,this.context.putImageData(t,e,i),this.pixelDataDirty=!1}applyImageData(){this.context.putImageData(this._imageData,0,0),this.pixelDataDirty=!1}floodFillRGBAandReturnOutputCanvas(t,e,i,a,r,h=255){let l=new O(this.width,this.height,"rgba(0,0,0,0)"),c=l.pixelData,o=this.pixelData;var u=0,d=[];d[0]=[{x:t,y:e}];let v=d[0],p=v,g=!0,x,_,m,b,D,w=this.width,S=9999999,I=9999999,y=0,T=0,f=(w*e+t)*4,E=o[f],M=o[f+1],N=o[f+2],F=o[f+3];o[f]=i,o[f+1]=a,o[f+2]=r,o[f+3]=h;for(var tt=this.width,z=this.height;g;)for(v=p,d[u++]=p=[],_=v.length,D=0,_==0&&(g=!1),x=0;x<_;x++)t=v[x].x,e=v[x].y,!(t<0||e<0||t>=tt||e>=z)&&(t>y&&(y=t),t<S&&(S=t),e>T&&(T=e),e<I&&(I=e),m=t-1,b=e-1,f=(w*b+m)*4,E==o[f]&&M==o[f+1]&&N==o[f+2]&&F==o[f+3]&&(o[f]=c[f]=i,o[f+1]=c[f+1]=a,o[f+2]=c[f+2]=r,o[f+3]=c[f+3]=h,p[D++]={x:m,y:b}),m=t,b=e-1,f=(w*b+m)*4,E==o[f]&&M==o[f+1]&&N==o[f+2]&&F==o[f+3]&&(o[f]=c[f]=i,o[f+1]=c[f+1]=a,o[f+2]=c[f+2]=r,o[f+3]=c[f+3]=h,p[D++]={x:m,y:b}),m=t+1,b=e-1,f=(w*b+m)*4,E==o[f]&&M==o[f+1]&&N==o[f+2]&&F==o[f+3]&&(o[f]=c[f]=i,o[f+1]=c[f+1]=a,o[f+2]=c[f+2]=r,o[f+3]=c[f+3]=h,p[D++]={x:m,y:b}),m=t+1,b=e,f=(w*b+m)*4,E==o[f]&&M==o[f+1]&&N==o[f+2]&&F==o[f+3]&&(o[f]=c[f]=i,o[f+1]=c[f+1]=a,o[f+2]=c[f+2]=r,o[f+3]=c[f+3]=h,p[D++]={x:m,y:b}),m=t+1,b=e+1,f=(w*b+m)*4,E==o[f]&&M==o[f+1]&&N==o[f+2]&&F==o[f+3]&&(o[f]=c[f]=i,o[f+1]=c[f+1]=a,o[f+2]=c[f+2]=r,o[f+3]=c[f+3]=h,p[D++]={x:m,y:b}),m=t,b=e+1,f=(w*b+m)*4,E==o[f]&&M==o[f+1]&&N==o[f+2]&&F==o[f+3]&&(o[f]=c[f]=i,o[f+1]=c[f+1]=a,o[f+2]=c[f+2]=r,o[f+3]=c[f+3]=h,p[D++]={x:m,y:b}),m=t-1,b=e+1,f=(w*b+m)*4,E==o[f]&&M==o[f+1]&&N==o[f+2]&&F==o[f+3]&&(o[f]=c[f]=i,o[f+1]=c[f+1]=a,o[f+2]=c[f+2]=r,o[f+3]=c[f+3]=h,p[D++]={x:m,y:b}),m=t-1,b=e,f=(w*b+m)*4,E==o[f]&&M==o[f+1]&&N==o[f+2]&&F==o[f+3]&&(o[f]=c[f]=i,o[f+1]=c[f+1]=a,o[f+2]=c[f+2]=r,o[f+3]=c[f+3]=h,p[D++]={x:m,y:b}));this.applyImageData(),l.applyImageData();var tt=y-S,z=T-I;return O.abstractCanvas.width=tt,O.abstractCanvas.height=z,O.abstractContext.drawImage(l.htmlCanvas,-S,-I),l.width=tt,l.height=z,l.context.drawImage(O.abstractCanvas,0,0),l.offsetX=S,l.offsetY=I,l}floodFillRGBA(t,e,i,a,r,h=255){let l=this.pixelData;var c=0,o=[];o[0]=[{x:t,y:e}];let u=o[0],d=u,v=!0,p,g,x,_,m,b=this.width,D=9999999,w=9999999,S=0,I=0,y=(b*e+t)*4,T=l[y],f=l[y+1],E=l[y+2],M=l[y+3];for(l[y]=i,l[y+1]=a,l[y+2]=r,l[y+3]=h;v;)for(u=d,o[c++]=d=[],g=u.length,m=0,g==0&&(v=!1),p=0;p<g;p++)t=u[p].x,e=u[p].y,t>S&&(S=t),t<D&&(D=t),e>I&&(I=e),e<w&&(w=e),x=t-1,_=e-1,y=(b*_+x)*4,T==l[y]&&f==l[y+1]&&E==l[y+2]&&M==l[y+3]&&(l[y]=i,l[y+1]=a,l[y+2]=r,l[y+3]=h,d[m++]={x,y:_}),x=t,_=e-1,y=(b*_+x)*4,T==l[y]&&f==l[y+1]&&E==l[y+2]&&M==l[y+3]&&(l[y]=i,l[y+1]=a,l[y+2]=r,l[y+3]=h,d[m++]={x,y:_}),x=t+1,_=e-1,y=(b*_+x)*4,T==l[y]&&f==l[y+1]&&E==l[y+2]&&M==l[y+3]&&(l[y]=i,l[y+1]=a,l[y+2]=r,l[y+3]=h,d[m++]={x,y:_}),x=t+1,_=e,y=(b*_+x)*4,T==l[y]&&f==l[y+1]&&E==l[y+2]&&M==l[y+3]&&(l[y]=i,l[y+1]=a,l[y+2]=r,l[y+3]=h,d[m++]={x,y:_}),x=t+1,_=e+1,y=(b*_+x)*4,T==l[y]&&f==l[y+1]&&E==l[y+2]&&M==l[y+3]&&(l[y]=i,l[y+1]=a,l[y+2]=r,l[y+3]=h,d[m++]={x,y:_}),x=t,_=e+1,y=(b*_+x)*4,T==l[y]&&f==l[y+1]&&E==l[y+2]&&M==l[y+3]&&(l[y]=i,l[y+1]=a,l[y+2]=r,l[y+3]=h,d[m++]={x,y:_}),x=t-1,_=e+1,y=(b*_+x)*4,T==l[y]&&f==l[y+1]&&E==l[y+2]&&M==l[y+3]&&(l[y]=i,l[y+1]=a,l[y+2]=r,l[y+3]=h,d[m++]={x,y:_}),x=t-1,_=e,y=(b*_+x)*4,T==l[y]&&f==l[y+1]&&E==l[y+2]&&M==l[y+3]&&(l[y]=i,l[y+1]=a,l[y+2]=r,l[y+3]=h,d[m++]={x,y:_});return this.context.putImageData(this._imageData,0,0),this.pixelDataDirty=!1,{pixels:o,bounds:new Qt(D,w,S,I)}}matchColor(t,e,i,a,r,h){let l=this.pixelData,c=(this.width*e+t)*4;return i==l[c]&&a==l[c+1]&&r==l[c+2]&&h==l[c+3]}matchRed(t,e,i){return i==this.pixelData[(this.width*e+t)*4]}matchGreen(t,e,i){return i==this.pixelData[(this.width*e+t)*4+1]}matchBlue(t,e,i){return i==this.pixelData[(this.width*e+t)*4+2]}matchAlpha(t,e,i){return i==this.pixelData[(this.width*e+t)*4+3]}isOpaque(t,e){return this.pixelData[(this.width*e+t)*4+3]==255}getColorBoundRect(t,e,i,a,r,h,l,c,o=0,u=null,d=null,v=null){let p=9999999,g=9999999,x=-99999999,_=-99999999,m=this.getPixels(t,e,i,a),b,D=m.length,w,S,I,y,T,f,E;for(u==null?u=d=v=o:d==null?(d=o,v=u):v==null&&(v=o),b=0;b<D;b+=4)w=m[b],S=m[b+1],I=m[b+2],y=m[b+3],w>=r-o&&w<=r+o&&S>=h-u&&S<=h+u&&I>=l-d&&I<=l+d&&y>=c-v&&y<=c+v&&(E=b*.25,T=b%i,f=E/i>>0,T<p&&(p=T),T>x&&(x=T),f<g&&(g=f),f>_&&(_=f));return p==9999999?null:{x:p,y:g,w:x-p,h:_-g}}getRedChannelBoundRect(t,e,i,a,r,h){return this.getChannelBoundRect(t,e,i,a,r,h,0)}getGreenChannelBoundRect(t,e,i,a,r,h){return this.getChannelBoundRect(t,e,i,a,r,h,1)}getBlueChannelBoundRect(t,e,i,a,r,h){return this.getChannelBoundRect(t,e,i,a,r,h,2)}getAlphaChannelBoundRect(t,e,i,a,r,h){return this.getChannelBoundRect(t,e,i,a,r,h,3)}getChannelBoundRect(t,e,i,a,r,h,l=3){let c=9999999,o=9999999,u=-99999999,d=-99999999,v=this.getPixels(t,e,i,a),p,g=v.length,x,_,m,b;for(p=0;p<g;p+=4)x=v[p+l],x>=r&&x<=h&&(b=p*.25,m=b/i>>0,_=b%i,_<c&&(c=_),_>u&&(u=_),m<o&&(o=m),m>d&&(d=m));return c==9999999||u-c==0||d-o==0?null:{x:c,y:o,w:u-c+1,h:d-o+1}}};n(O,"IMAGE_LOADED","IMAGE_LOADED"),n(O,"abstractCanvas",document.createElement("canvas")),n(O,"abstractContext",O.abstractCanvas.getContext("2d",{willReadFrequently:!0}));let k=O;const G=class G extends Tt{constructor(t,e=-1,i=0,a=1){super();n(this,"_r");n(this,"_g");n(this,"_b");n(this,"_a");n(this,"_style");n(this,"useAlpha",!1);var r=void 0;if(e==-1){if(typeof t=="string"){var h=t.split("#").join("0x");t=Number(h)}var l=t;t>16777215?(a=l>>>24,r=l>>>16&255,e=l>>>8&255,i=l&255):(r=l>>16,e=l>>8&255,i=l&255,a=1)}r==null&&(r=t),this._r=r,this._g=e,this._b=i,this._a=a,this.updateStyle()}clone(){return new G(this._r,this._g,this._b,this._a)}get dataString(){return this._r+","+this._g+","+this._b+","+this._a}static fromDataString(t){const e=t.split(",");return new G(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3]))}get r(){return this._r}set r(t){this._r!=t&&(this._r=t,this.updateStyle())}get g(){return this._g}set g(t){this._g!=t&&(this._g=t,this.updateStyle())}get b(){return this._b}set b(t){this._b!=t&&(this._b=t,this.updateStyle())}get a(){return this._a}set a(t){this._a!=t&&(this._a=t,this.updateStyle())}setRGB(t,e,i){this.useAlpha=!1,this._r=t,this._g=e,this._b=i,this.updateStyle()}setRGBA(t,e,i,a){this.useAlpha=!0,this._r=t,this._g=e,this._b=i,this._a=a,this.updateStyle()}createBrighterColor(t){var e=this._r+(255-this._r)*t,i=this._g+(255-this._g)*t,a=this._b+(255-this._b)*t;return new G(e,i,a)}createDarkerColor(t){var e=this._r*(1-t),i=this._g*(1-t),a=this._b*(1-t);return new G(e,i,a)}updateStyle(t=!0){this.useAlpha?this._style="rgba("+this._r+","+this._g+","+this._b+","+this._a+")":this._style="rgb("+this._r+","+this._g+","+this._b+")",t&&this.dispatchEvent(G.UPDATE_STYLE)}get style(){return this._style}};n(G,"UPDATE_STYLE","UPDATE_STYLE"),n(G,"INVISIBLE_COLOR",new G(0,0,0,0));let B=G;const nt=class nt extends Tt{constructor(t=null,e=null,i=!0){super();n(this,"colors",null);n(this,"ratios",null);n(this,"nbStep",0);n(this,"x0",0);n(this,"y0",0);n(this,"r0",0);n(this,"x1",0);n(this,"y1",0);n(this,"r1",0);n(this,"style",null);n(this,"ctx",null);n(this,"onUpdateStyle",null);n(this,"dirty",!0);n(this,"isLinear");n(this,"scaleX",1);n(this,"scaleY",1);n(this,"x",0);n(this,"y",0);n(this,"rotation",0);n(this,"radialFlareX",0);n(this,"radialFlareY",0);n(this,"radialFlareStrength",1);n(this,"_scaleX",1);n(this,"_scaleY",1);n(this,"_x",0);n(this,"_y",0);n(this,"_rotation",0);n(this,"_radialFlareX",0);n(this,"_radialFlareY",0);n(this,"_radialFlareStrength",1);t?this.setColorStep(t,e):(this.colors=[],this.ratios=[]),this.isLinear=i}get dataString(){if(!this.colors||!this.ratios)return"";let t,e=this.colors.length,i="",a="";for(t=0;t<e;t++)t!=0&&(i+=",",a+=","),i+=this.colors[t].REGISTER_ID,a+=this.ratios[t];let r=0;return this.isLinear&&(r=1),i+"|"+a+"|"+r}static fromDataString(t){let e=t.split("|"),i=e[0].split(","),a=e[1].split(","),r=e[2]=="1",h,l=i.length,c=[],o=[];for(h=0;h<l;h++)c[h]=C.instance.getObjectByRegisterId(i[h]),o[h]=Number(a[h]);return new nt(c,o,r)}clone(t=!1){if(!this.colors||!this.ratios)return null;let e;if(t){e=[];let i,a=this.colors.length;for(i=0;i<a;i++)e[i]=this.colors[i].clone();return new nt(e,this.ratios.concat(),this.isLinear)}else return new nt(this.colors.concat(),this.ratios.concat(),this.isLinear)}transformValues(t=0,e=0,i=1,a=1,r=0,h=0,l=0,c=0){this._x=t,this._y=e,this._scaleX=i,this._scaleY=a,this._rotation=r,this._radialFlareX=h,this._radialFlareY=l,this._radialFlareStrength=c,this.dirty=!0}initFromPoints(t,e,i,a,r=0,h=0){this.x0=t,this.y0=e,this.r0=r,this.x1=i,this.y1=a,this.r1=h,this.dirty=!0}initLinearFromRect(t,e,i,a,r){const h=i/2,l=a/2,c=Math.sqrt(h*h+l*l),o=r+Math.PI,u=r;t+=h,e+=l,this.x0=t+Math.cos(o)*c,this.y0=e+Math.sin(o)*c,this.x1=t+Math.cos(u)*c,this.y1=e+Math.sin(u)*c,this.dirty=!0}initRadialFromRect(t,e,i,a,r=0,h=0,l=1){r<=-1&&(r=-.999),h<=-1&&(h=-.999),r>=1&&(r=.999),h>=1&&(h=.999);const c=i/2,o=a/2,u=Math.sqrt(c*c+o*o);t+=c,e+=o;const d=Math.atan2(h,r),v=Math.cos(d)*(u*r),p=Math.sin(d)*(u*h),g=Math.sqrt(v*v+p*p);this.x0=t+Math.cos(d)*g,this.x1=t,this.y0=e+Math.sin(d)*g,this.y1=e,this.r0=0,this.r1=u*l,this.dirty=!0}setColorStep(t,e){let i,a,r,h;if(t.length>1)if(e&&t.length<=e.length)this.ratios=e,this.nbStep=t.length,this.colors=t;else for(this.nbStep=a=t.length,r=0,h=1/(a-1),this.ratios=[],i=0;i<a;i++)this.ratios[i]=r,r+=h;else t.push(t[0]),this.nbStep=2,this.ratios=[0,1];a=this.nbStep;const l=()=>{var c;this.dirty=!0,this.ctx&&this.getGradientStyle(this.ctx),(c=this.onUpdateStyle)==null||c.call(this)};for(i=0;i<a;i++)this.colors&&this.colors[i]&&this.colors[i].removeEventListener(B.UPDATE_STYLE,l),t[i].addEventListener(B.UPDATE_STYLE,l);this.colors=t,this.dirty=!0}addColorStep(t,e=0,i=0,a=0,r=1){if(!this.colors||!this.ratios)return null;var h=this.colors[this.nbStep]=new B(e,i,a,r);return this.ratios[this.nbStep++]=t,h}getColorById(t){return this.colors?this.colors[t]:null}setColorById(t,e){if(!this.colors||!this.ratios)return"";this.colors[t]!=null&&(this.colors[t].removeEventListener(B.UPDATE_STYLE,this.onUpdateStyle),this.colors[t]=e,e.addEventListener(B.UPDATE_STYLE,this.onUpdateStyle))}getRatioById(t){return this.ratios?this.ratios[t]:0}setRatioById(t,e){this.ratios[t]=e}getGradientStyle(t,e){if(!this.colors||!this.ratios)return null;let i;if(this.dirty||this.ctx!=t){this.ctx=t;const a=this.x+this._x,r=this.y+this._y,h=this.scaleX*this._scaleX,l=this.scaleY*this._scaleY,c=this.rotation+this._rotation,o=this.radialFlareX*this._radialFlareX,u=this.radialFlareY*this._radialFlareY,d=this.radialFlareStrength*this._radialFlareStrength;this.isLinear?(this.initLinearFromRect(a,r,h,l,c),i=t.createLinearGradient(this.x0,this.y0,this.x1,this.y1)):(this.initRadialFromRect(a,r,h,l,o,u,d),i=t.createRadialGradient(this.x0,this.y0,this.r0,this.x1,this.y1,this.r1));let v,p=this.nbStep;const g=this.ratios,x=this.colors;for(v=0;v<p;v++)i.addColorStop(g[v],x[v].style);this.style=i,this.dirty=!1,this.dispatchEvent(nt.UPDATE_STYLE)}return this.style}};n(nt,"UPDATE_STYLE","UPDATE_STYLE");let yt=nt;const A=class A{constructor(s=0,t=0,e=!1){n(this,"x");n(this,"y");n(this,"isCurveAnchor");this.x=s,this.y=t,this.isCurveAnchor=e}equals(s){return this.x==s.x&&this.y==s.y}add(s){return new A(this.x+s.x,this.y+s.y)}substract(s){return new A(this.x-s.x,this.y-s.y)}multiply(s){return new A(this.x*s.x,this.y*s.y)}divide(s){return new A(this.x/s.x,this.y/s.y)}normalize(){let s=Math.sqrt(this.dot(this));return new A(this.x/s,this.y/s)}dot(s){return this.x*s.x+this.y*s.y}greaterThan(s){return this.x>s.x||this.x==s.x&&this.y>s.y}static distance(s,t){let e=s.x-t.x,i=s.y-t.y;return Math.sqrt(e*e+i*i)}};n(A,"X",new A(1,0)),n(A,"Y",new A(0,1)),n(A,"ZERO",new A(0,0));let U=A;class H{}n(H,"TOP_LEFT",new U(0,0)),n(H,"TOP_CENTER",new U(.5,0)),n(H,"TOP_RIGHT",new U(1,0)),n(H,"CENTER_LEFT",new U(0,.5)),n(H,"CENTER",new U(.5,.5)),n(H,"CENTER_RIGHT",new U(1,.5)),n(H,"BOTTOM_LEFT",new U(0,1)),n(H,"BOTTOM_CENTER",new U(.5,1)),n(H,"BOTTOM_RIGHT",new U(1,1));const vt=class vt extends Tt{constructor(){super();n(this,"x",0);n(this,"y",0);n(this,"xAxis",0);n(this,"yAxis",0);n(this,"rotation",0);n(this,"scaleX",1);n(this,"scaleY",1);n(this,"width",1);n(this,"height",1);n(this,"offsetW",0);n(this,"offsetH",0);n(this,"matrix");n(this,"savedMatrixs");this.savedMatrixs=[],this.matrix=new DOMMatrix}get dataString(){var t=[this.x,this.y,this.xAxis,this.yAxis,this.rotation,this.scaleX,this.scaleY,this.width,this.height,this.offsetW,this.offsetH].join(",");return t+="#",t+=[this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f].join(","),t}static fromDataString(t,e){var i=t.split("#"),a=i[0].split(","),r=i[1].split(","),h;return e?h=e:h=new vt,h.x=Number(a[0]),h.y=Number(a[1]),h.xAxis=Number(a[2]),h.yAxis=Number(a[3]),h.rotation=Number(a[4]),h.scaleX=Number(a[5]),h.scaleY=Number(a[6]),h.width=Number(a[7]),h.height=Number(a[8]),h.offsetW=Number(a[9]),h.offsetH=Number(a[10]),h.domMatrix.a=Number(r[0]),h.domMatrix.b=Number(r[1]),h.domMatrix.c=Number(r[2]),h.domMatrix.d=Number(r[3]),h.domMatrix.e=Number(r[4]),h.domMatrix.f=Number(r[5]),h}save(){let t=this.savedMatrixs,e=null;t&&(e=t);var i={matrix:this.matrix.toString(),next:e};this.savedMatrixs=i}restore(){this.setMatrixValue(this.savedMatrixs.matrix),this.savedMatrixs=this.savedMatrixs.next}get realWidth(){return this.width}get realHeight(){return this.height}clone(){var t=new vt;return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.xAxis=this.xAxis,t.yAxis=this.yAxis,t.width=this.width,t.height=this.height,t.setMatrixValue(this.matrix.toString()),t}applyTransform(){const t=this.matrix;return t.translateSelf(this.x,this.y),t.rotateSelf(this.rotation),t.translateSelf(-this.xAxis*this.scaleX,-this.yAxis*this.scaleY),t.scaleSelf(this.width*this.scaleX,this.height*this.scaleY),t}setMatrixValue(t="matrix(1, 0, 0, 1, 0, 0)"){return this.matrix.setMatrixValue(t)}translate(t,e){return this.matrix.translateSelf(t,e)}rotate(t){return this.matrix.rotateSelf(t)}scale(t,e){return this.matrix.scaleSelf(t,e)}invert(){return this.matrix.invertSelf()}rotateFromVector(t,e){return this.matrix.rotateFromVectorSelf(t,e)}multiply(t){this.matrix.multiplySelf(t.domMatrix)}preMultiply(t){this.matrix.preMultiplySelf(t.domMatrix)}identity(){this.matrix.setMatrixValue("matrix(1, 0, 0, 1, 0, 0)")}get domMatrix(){return this.matrix}};n(vt,"IDENTITY",new DOMMatrix("matrix(1, 0, 0, 1, 0, 0)"));let xt=vt;const it=class it{constructor(){n(this,"CONCAVE",-1);n(this,"CONVEX",1);n(this,"indices");n(this,"vertices");n(this,"vertexCount");n(this,"vertexTypes");n(this,"triangles");if(it._instance)throw new Error("You must use EarCutting.instance");it._instance=this,this.vertexTypes=[],this.triangles=[]}static get instance(){return it._instance||new it,it._instance}computeSpannedAreaSign(s,t,e,i,a,r){var h=s*(r-i);return h+=e*(t-r),h+=a*(i-t),h<0?-1:h>0?1:0}previousIndex(s){return(s==0?this.vertexCount:s)-1}nextIndex(s){return(s+1)%this.vertexCount}classifyVertex(s){let t=this.indices[this.previousIndex(s)]*2,e=this.indices[s]*2,i=this.indices[this.nextIndex(s)]*2;return this.computeSpannedAreaSign(this.vertices[t],this.vertices[t+1],this.vertices[e],this.vertices[e+1],this.vertices[i],this.vertices[i+1])}areVerticesClockwise(s,t,e){if(e<=2)return!1;let i=0,a,r,h,l,c,o;for(c=t,o=t+e-3;c<o;c+=2)a=s[c],r=s[c+1],h=s[c+2],l=s[c+3],i+=a*l-h*r;return a=s[e-2],r=s[e-1],h=s[0],l=s[1],i+a*l-h*r<0}isEarTip(s){if(this.vertexTypes[s]==this.CONCAVE)return!1;let t=this.previousIndex(s),e=this.nextIndex(s),i=this.indices[t]*2,a=this.indices[s]*2,r=this.indices[e]*2,h=this.vertices[i],l=this.vertices[i+1],c=this.vertices[a],o=this.vertices[a+1],u=this.vertices[r],d=this.vertices[r+1],v,p,g,x;for(v=this.nextIndex(e);v!=t;v=this.nextIndex(v))if(this.vertexTypes[v]!=this.CONVEX&&(p=this.indices[v]*2,g=this.vertices[p],x=this.vertices[p+1],this.computeSpannedAreaSign(u,d,h,l,g,x)>=0&&this.computeSpannedAreaSign(h,l,c,o,g,x)>=0&&this.computeSpannedAreaSign(c,o,u,d,g,x)>=0))return!1;return!0}findEarTip(){let s;for(s=0;s<this.vertexCount;s++)if(this.isEarTip(s))return s;for(s=0;s<this.vertexCount;s++)if(this.vertexTypes[s]!=this.CONCAVE)return s;return 0}cutEarTip(s){this.triangles.push(this.indices[this.previousIndex(s)]),this.triangles.push(this.indices[s]),this.triangles.push(this.indices[this.nextIndex(s)]),this.indices.splice(s,1),this.vertexTypes.splice(s,1),this.vertexCount--}triangulate(){let s=0,t=0,e=0;for(;this.vertexCount>3;)s=this.findEarTip(),this.cutEarTip(s),t=this.previousIndex(s),e=s==this.vertexCount?0:s,this.vertexTypes[t]=this.classifyVertex(t),this.vertexTypes[e]=this.classifyVertex(e);this.vertexCount==3&&(this.triangles.push(this.indices[0]),this.triangles.push(this.indices[1]),this.triangles.push(this.indices[2]))}_computeTriangles(s,t,e){this.vertices=s,this.vertexCount=e/2,this.indices=[];var i,a;if(this.areVerticesClockwise(this.vertices,t,e))for(i=0;i<this.vertexCount;i++)this.indices[i]=i;else for(i=0,a=this.vertexCount-1;i<this.vertexCount;i++)this.indices[i]=a-i;for(this.vertexTypes=[],i=0,a=this.vertexCount;i<a;++i)this.vertexTypes[i]=this.classifyVertex(i);return this.triangles=[],this.triangulate(),this.triangles}computeTriangles(s){return this._computeTriangles(s,0,s.length)}};n(it,"_instance");let Vt=it;const lt=class lt{constructor(s=null){n(this,"oldX");n(this,"oldY");n(this,"minX");n(this,"minY");n(this,"maxX");n(this,"maxY");n(this,"_shapeBounds");n(this,"_boundPoints");n(this,"_shapePoints");n(this,"_shapeXYs");n(this,"_shapeXY");n(this,"_nbShape",0);n(this,"_nbBoundPoint",0);n(this,"_indexs");n(this,"firstPoint");n(this,"lastPoint");s&&this.getPoints(s.pathDatas)}get trianglePoints(){return this._boundPoints}get triangleIndexs(){return this._indexs}getBounds(s,t,e){let i=this.firstPoint,a,r,h,l=99999999,c=99999999,o=-99999999,u=-99999999,d=s.domMatrix,v=t,p=e;for(;i;)a=d.transformPoint(i),r=a.x,h=a.y,r<l&&(l=r),r>o&&(o=r),h<c&&(c=h),h>u&&(u=h),i=i.next;return s.bounds.init(l-v,c-p,o+v,u+p)}getPoints(s){this._boundPoints=[],this._shapeXYs=[],this._shapeBounds=[],this.oldX=0,this.oldY=0;let t=0,e=s.length,i;for(;t<e;)switch(i=s[t++],i){case 0:this.moveTo(s[t++],s[t++]);break;case 1:this.lineTo(s[t++],s[t++]);break;case 2:this.circle(s[t++],s[t++],s[t++]);break;case 3:this.quadraticCurveTo(s[t++],s[t++],s[t++],s[t++]);break;case 4:this.rect(s[t++],s[t++],s[t++],s[t++]);break;case 5:this.arc(s[t++],s[t++],s[t++],s[t++],s[t++]);break;case 6:this.arcTo(s[t++],s[t++],s[t++],s[t++],s[t++]);break;case 7:this.bezierCurveTo(s[t++],s[t++],s[t++],s[t++],s[t++],s[t++]);break}}triangulate(){this._indexs=[],this.endProcess(),this._indexs=[];var s,t=this._nbShape;for(s=0;s<t;s++)this._indexs[s]=Vt.instance.computeTriangles(this._shapeXYs[s])}endProcess(){this._nbShape!=0&&(this._shapeBounds[this._nbShape-1]={minX:this.minX,minY:this.minY,maxX:this.maxX,maxY:this.maxY})}defineNewShape(){this.endProcess(),this.oldX=0,this.oldY=0,this._shapePoints=[],this._shapeXY=[],this._boundPoints[this._nbShape]=this._shapePoints,this._shapeXYs[this._nbShape]=this._shapeXY,this._nbShape++,this._nbBoundPoint=0}registerPoint(s,t){s<this.minX&&(this.minX=s),s>this.maxX&&(this.maxX=s),t<this.minY&&(this.minY=t),t>this.maxY&&(this.maxY=t),this.oldX=s,this.oldY=t;var e=this.lastPoint;this._shapeXY.push(s,t),this._shapePoints[this._nbBoundPoint++]=this.lastPoint=new DOMPoint(s,t,0,1),e&&(e.next=this.lastPoint),this.lastPoint.prev=e,this.firstPoint||(this.firstPoint=this.lastPoint)}moveTo(s,t){this.defineNewShape(),this.registerPoint(s,t)}lineTo(s,t){this.registerPoint(s,t)}arcTo(s,t,e,i,a){var r=this.oldX,h=this.oldY;let l=s-r,c=t-h,o=Math.atan2(c,l);l=e-s,c=i-t,o=Math.atan2(c,l);let u=s+Math.cos(o)*a,d=t+Math.sin(o)*a;this.quadraticCurveTo(s,t,u,d)}arc(s,t,e,i,a){this.defineNewShape();let r=Math.abs(a-i),h=Math.PI/8;this.registerPoint(s+Math.cos(i)*e,t+Math.sin(i)*e);let l=0;for(;l+h<r;)l+=h,this.registerPoint(s+Math.cos(i+l)*e,t+Math.sin(i+l)*e);this.registerPoint(s+Math.cos(i+r)*e,t+Math.sin(i+r)*e)}circle(s,t,e){this.arc(s,t,e,0,Math.PI*2)}rect(s,t,e,i){this.defineNewShape(),this.registerPoint(s,t),this.registerPoint(s+e,t),this.registerPoint(s+e,t+i),this.registerPoint(s,t+i)}getQuadraticCurveLength(s,t,e,i){var a=this.oldX,r=this.oldY;let h=a,l=r,c,o,u=0,d,v=10,p,g,x;for(d=1;d<v;d++)x=d/v,p=(1-x)*(1-x)*a+2*(1-x)*x*s+x*x*e,g=(1-x)*(1-x)*r+2*(1-x)*x*t+x*x*i,c=p-h,o=g-l,u+=Math.sqrt(c*c+o*o),h=p,l=g;return c=e-h,o=i-l,u+=Math.sqrt(c*c+o*o),u}quadraticCurveTo(s,t,e,i){var a=this.oldX,r=this.oldY;let h=Math.ceil(this.getQuadraticCurveLength(s,t,e,i)/lt.curvePointDistance),l,c=Math.max(Math.min(h,lt.curvePointMax),4),o,u,d;for(l=1;l<=c;l++)d=l/c,o=(1-d)*(1-d)*a+2*(1-d)*d*s+d*d*e,u=(1-d)*(1-d)*r+2*(1-d)*d*t+d*d*i,this.registerPoint(o,u)}getBezierCurveLength(s,t,e,i,a,r){var h=this.oldX,l=this.oldY;let c,o=5,u,d,v,p,g,x,_,m,b,D=h,w=l,S,I,y=0;for(c=1;c<o;c++)v=c/o,p=3*(s-h),g=3*(e-s)-p,x=a-h-p-g,_=3*(t-l),m=3*(i-t)-_,b=r-l-_-m,u=x*Math.pow(v,3)+g*Math.pow(v,2)+p*v+h,d=b*Math.pow(v,3)+m*Math.pow(v,2)+_*v+l,S=u-D,I=d-w,y+=Math.sqrt(S*S+I*I),D=u,w=d;return S=a-D,I=r-w,y+=Math.sqrt(S*S+I*I),y}bezierCurveTo(s,t,e,i,a,r){var h=this.oldX,l=this.oldY,c=Math.ceil(this.getBezierCurveLength(s,t,e,i,a,r)/lt.curvePointDistance),o,u=c,d,v,p,g,x,_,m,b,D;for(o=1;o<=u;o++)p=o/u,g=3*(s-h),x=3*(e-s)-g,_=a-h-g-x,m=3*(t-l),b=3*(i-t)-m,D=r-l-m-b,d=_*Math.pow(p,3)+x*Math.pow(p,2)+g*p+h,v=D*Math.pow(p,3)+b*Math.pow(p,2)+m*p+l,this.registerPoint(d,v)}};n(lt,"curvePointMax",5),n(lt,"curvePointDistance",10);let Rt=lt;const j=class j extends q{constructor(t=null){super();n(this,"_path");n(this,"_originalW");n(this,"_originalH");n(this,"_originalX");n(this,"_originalY");n(this,"_geom");n(this,"datas");n(this,"bounds",{x:0,y:0,w:0,h:0});this._path=new Path2D,t?(this.datas=t,this.computePath()):this.datas=[]}get dataString(){return this.datas.join(",")}static fromDataString(t){var e=t.split(","),i=[];let a,r=e.length;for(a=0;a<r;a++)i[a]=Number(e[a]);return new j(i)}newPath(){return this._path=new Path2D,this._path}isPointInPath(t,e,i,a="nonzero"){return t.isPointInPath(this.path,e,i,a)}isPointInStroke(t,e,i){return t.isPointInStroke(this.path,e,i)}isPointInside(t,e,i,a,r="nonzero"){return a?t.isPointInStroke(this.path,e,i):t.isPointInPath(this.path,e,i,r)}get originalW(){return this._originalW}get originalH(){return this._originalH}get originalX(){return this._originalX}get originalY(){return this._originalY}moveTo(t,e){this.datas.push(0,t,e)}lineTo(t,e){this.datas.push(1,t,e)}circle(t,e,i){this.arc(t,e,i)}quadraticCurveTo(t,e,i,a){this.datas.push(3,t,e,i,a)}rect(t,e,i,a){this.datas.push(4,t,e,i,a)}arc(t,e,i,a=0,r=Math.PI*2){this.datas.push(5,t,e,i,a,r)}arcTo(t,e,i,a,r){this.datas.push(6,t,e,i,a,r)}bezierCurveTo(t,e,i,a,r,h){this.datas.push(7,t,e,i,a,r,h)}static moveTo(t,e,i){t.moveTo(e[i+1],e[i+2])}static lineTo(t,e,i){t.lineTo(e[i+1],e[i+2])}static circle(t,e,i){t.arc(e[i+1],e[i+2],e[i+3],0,Math.PI*2)}static rect(t,e,i){t.rect(e[i+1],e[i+2],e[i+3],e[i+4])}static quadraticCurveTo(t,e,i){t.quadraticCurveTo(e[i+1],e[i+2],e[i+3],e[i+4])}static arc(t,e,i){t.arc(e[i+1],e[i+2],e[i+3],e[i+4],e[i+5])}static arcTo(t,e,i){t.arc(e[i+1],e[i+2],e[i+3],e[i+4],e[i+5])}static bezierCurveTo(t,e,i){t.bezierCurveTo(e[i+1],e[i+2],e[i+3],e[i+4],e[i+5],e[i+6])}get path(){return this._path}get geometry(){return this._geom}get pathDatas(){return this.datas}computePath(){let t,e,i,a=9999999,r=9999999,h=-9999999,l=-9999999,c,o,u,d=this.datas,v,p,g,x,_;const m=d.length,b=j.objByType;for(t=0;t<m;t+=p+1){for(i=d[t],_=b[i],p=_.count,g=_.countOffset,x=_.useRadius,o=t+1,c=p-g,c+=o,x&&c--,e=o;e<c;e++)u=d[e],u<a&&(a=u),u<r&&(r=u),u>h&&(h=u),u>l&&(l=u);x&&(u=d[c])}let D=h-a,w=l-r;x&&(D=1,w=1,a=r=0),this._originalW=Math.abs(D),this._originalH=Math.abs(w),this._originalX=a,this._originalY=r;const S=this._path;for(t=0;t<m;t+=p+1){for(i=d[t],_=b[i],v=_.func,p=_.count,g=_.countOffset,x=_.useRadius,o=t+1,c=o+p-g,x&&c--,e=o;e<c;e++)u=d[e],e%2==0?(u-=a,u/=D):(u-=r,u/=w),d[e]=u;x&&(u=d[c],d[c]=u),v(S,d,o-1)}return this._geom=new Rt(this),this._geom}};n(j,"objByType",[{func:j.moveTo,count:2,endXY:3,countOffset:0,useRadius:!1},{func:j.lineTo,count:2,endXY:3,countOffset:0,useRadius:!1},{func:j.arc,count:3,endXY:3,countOffset:0,useRadius:!0},{func:j.quadraticCurveTo,count:4,endXY:5,countOffset:0,useRadius:!1},{func:j.rect,count:4,endXY:3,countOffset:0,useRadius:!1},{func:j.arc,count:5,endXY:3,countOffset:2,useRadius:!0},{func:j.arcTo,count:2,endXY:3,countOffset:2,useRadius:!0},{func:j.bezierCurveTo,count:6,endXY:7,countOffset:0,useRadius:!1}]);let ht=j;class K extends q{constructor(){super();n(this,"fillPathRule","nonzero");n(this,"styleType");n(this,"alpha",1);n(this,"lineStyle",null);n(this,"textStyle",null);n(this,"filters",null);n(this,"needsUpdate",!0);n(this,"offsetW",0);n(this,"offsetH",0);n(this,"dirty",!0);n(this,"_cacheAsBitmap",!1);n(this,"cacheDirty",!1);n(this,"cache",null)}apply(t,e,i){i.fillStrokeDrawable&&(t.globalAlpha=this.alpha*i.globalAlpha);let a=this.filters;a?(this.dirty=a.dirty,i.fillStrokeDrawable&&(t.filter=a.value),this.offsetW=a.boundOffsetW,this.offsetH=a.boundOffsetH):t.filter="none"}get cacheAsBitmap(){return this._cacheAsBitmap}set cacheAsBitmap(t){this._cacheAsBitmap!=t&&(this._cacheAsBitmap=t,t&&(this.cacheDirty=!0))}get isFill(){return this.styleType=="fillStyle"}get isStroke(){return this.styleType=="strokeStyle"}get globalOffsetW(){return this.offsetW+this.lineWidth}get globalOffsetH(){return this.offsetH+this.lineWidth}get lineWidth(){return this.lineStyle==null?0:this.lineStyle.lineWidth}}n(K,"radian",Math.PI/180);class te extends k{constructor(t,e=null){super(1,1);n(this,"target");n(this,"renderStackElement");n(this,"needsUpdate",!1);this.target=t,this.renderStackElement=e}draw(t,e,i){const a=this.target;t.save(),this.renderStackElement||(t.globalAlpha=a.globalAlpha),t.scale(1/(this.width-e*2),1/(this.height-i*2)),t.translate(-e,-i),t.drawImage(this.canvas,0,0),t.restore()}updateCache(t=!1){if(this.needsUpdate==!0||t){const i=this.target.width*this.target.scaleX,a=this.target.height*this.target.scaleY,r=this.context,h=this.target;if(this.renderStackElement){if(this.renderStackElement.value instanceof K){const l=this.renderStackElement.value;this.width=i+l.offsetW*2,this.height=a+l.offsetH*2,r.save();var e=new DOMMatrix().translate(l.offsetW,l.offsetH).scale(i,a);r.setTransform(e.a,e.b,e.c,e.d,e.e,e.f),l.apply(r,this.renderStackElement.lastPath,h),this.context.restore()}}else{const l=h.renderStack;l.updateBounds(h),this.width=i+l.offsetW*2,this.height=a+l.offsetH*2,r.save();var e=new DOMMatrix().translate(l.offsetW,l.offsetH).scale(i,a);r.setTransform(e.a,e.b,e.c,e.d,e.e,e.f);let o,u,d,v=h.renderStack.elements,p,g=v.length;for(p=0;p<g;p++)o=v[p],r.save(),o.enabled&&(o.isShape?o.value.apply(r,h):o.isPath?u=o.value:o.isTextPath?d=o.value:o.isTextFillStroke?o.value.apply(r,d,h):o.value.apply(r,u,h)),r.restore();r.restore()}this.needsUpdate=!1}}}class Et extends q{constructor(t){super();n(this,"text");this.text=t}get dataString(){return this.text}static fromDataString(t){return new Et(t)}isPointInside(t,e,i,a,r="nonzero"){return!1}isPointInPath(t,e,i){return!1}isPointInStroke(t,e,i){return!1}}class ee extends K{constructor(t,e=!0){super();n(this,"bd");this.bd=t,this.styleType="fillStyle"}get width(){return this.bd.width}get height(){return this.bd.height}apply(t,e,i){t.drawImage(this.bd.htmlCanvas,0,0)}}class dt extends K{constructor(t,e=!0){super();n(this,"bd");n(this,"centerInto",!1);n(this,"x",0);n(this,"y",0);n(this,"scaleX",1);n(this,"scaleY",1);n(this,"rotation",0);this.bd=t,this.centerInto=e,this.styleType="fillStyle"}get dataString(){var t=0;return this.centerInto&&(t=1),this.bd.REGISTER_ID+","+t}static fromDataString(t){var e=t.split(",");return new dt(C.instance.getObjectByRegisterId(e[0]),e[1]=="1")}clone(t=!1,e=!0){var i;return t?i=new dt(this.bd.clone()):i=new dt(this.bd),i.x=this.x,i.y=this.y,i.scaleX=this.scaleX,i.scaleY=this.scaleY,i.rotation=this.rotation,this.lineStyle&&(e?i.lineStyle=this.lineStyle.clone():i.lineStyle=this.lineStyle),i}apply(t,e,i){const a=this.bd.htmlCanvas;t.save(),t.clip(e.path),t.scale(i.inverseW*this.scaleX,i.inverseH*this.scaleY),t.translate(i.xAxis,i.yAxis),t.rotate(this.rotation),this.centerInto&&t.translate((i.width-a.width)*.5,(i.height-a.height)*.5),t.translate(this.x,this.y),super.apply(t,e,i),i.fillStrokeDrawable&&t.drawImage(a,0,0),t.restore()}}class ot extends K{constructor(t,e=!0){super();n(this,"_gradient");n(this,"_isLinear");n(this,"_x",0);n(this,"_y",0);n(this,"_scaleX",1);n(this,"_scaleY",1);n(this,"_rotation",0);n(this,"_radialFlareX",0);n(this,"_radialFlareY",0);n(this,"_radialFlareStrength",1);n(this,"dirty",!0);n(this,"_name");n(this,"gradientCanvas");this._gradient=t,this._isLinear=e,t.addEventListener(yt.UPDATE_STYLE,()=>{this.dirty=!0})}clone(t=!1,e=!1,i=!0,a=!0,r=!0){var h;return t?h=new ot(this._gradient.clone(e)):h=new ot(this._gradient),h.fillPathRule=this.fillPathRule,h.styleType=this.styleType,h.x=this.x,h.y=this.y,h.scaleX=this.scaleX,h.scaleY=this.scaleY,h.rotation=this.rotation,h.radialFlareX=this.radialFlareX,h.radialFlareY=this.radialFlareY,h.radialFlareStrength=this.radialFlareStrength,h.alpha=this.alpha,this.lineStyle&&(i?h.lineStyle=this.lineStyle.clone():h.lineStyle=this.lineStyle),this.textStyle&&(a?h.textStyle=this.textStyle.clone(r):h.textStyle=this.textStyle),h}get gradient(){return this._gradient}set gradient(t){this._gradient=t,this.dirty=!0}get isLinear(){return this._isLinear}set isLinear(t){this._isLinear=t,this.dirty=!0}get x(){return this._x}set x(t){this._x=t,this.dirty=!0}get y(){return this._x}set y(t){this._y=t,this.dirty=!0}get scaleX(){return this._scaleX}set scaleX(t){this._scaleX=t,this.dirty=!0}get scaleY(){return this._scaleY}set scaleY(t){this._scaleY=t,this.dirty=!0}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this.dirty=!0}get radialFlareX(){return this._radialFlareX}set radialFlareX(t){this._radialFlareX=t,this.dirty=!0}get radialFlareY(){return this._radialFlareY}set radialFlareY(t){this._radialFlareY=t,this.dirty=!0}get radialFlareStrength(){return this._radialFlareStrength}set radialFlareStrength(t){this._radialFlareStrength=t,this.dirty=!0}apply(t,e,i){(this.dirty||this._gradient.dirty)&&(this._gradient.transformValues(this._x,this._y,this._scaleX,this._scaleY,this._rotation,this._radialFlareX,this._radialFlareY,this._radialFlareStrength),this.gradientCanvas=this._gradient.getGradientStyle(t,i),this.dirty=!1),super.apply(t,e,i),t[this.styleType]=this.gradientCanvas}}class Yt extends ot{constructor(s,t=!0){super(s,t),this.styleType="fillStyle"}get dataString(){var s=0;return this.isLinear&&(s=1),this.gradient.REGISTER_ID+","+s}static fromDataString(s){var t=s.split(",");return new Yt(C.instance.getObjectByRegisterId(t[0]),t[1]=="1")}apply(s,t,e){super.apply(s,t,e),e.fillStrokeDrawable&&s.fill(t.path,this.fillPathRule)}}class Ft extends k{constructor(t,e,i="",a=!0,r=!0){super(1,1);n(this,"video");n(this,"playerW");n(this,"playerH");n(this,"videoW");n(this,"videoH");n(this,"duration");n(this,"playing",!1);n(this,"canPlay",!1);n(this,"useBitmapData",!1);n(this,"bmp");n(this,"firstFrameRendered",!1);n(this,"oldTime",-1e4);n(this,"crop",!0);n(this,"loop",!0);n(this,"fps",30);n(this,"url");this.playerW=t,this.playerH=e;var h=this.video=document.createElement("video");h.style.visibility="hidden",h.width=t,h.height=e,h.muted=a,h.autoplay=r,h.src=this.url=i,this.useNativeBitmapData=!0;var l=this,c=!1;h.onpause=function(){l.playing=!1},h.onwaiting=function(){l.playing=!1},h.onplay=function(){l.playing=!0},h.onended=function(){l.playing=!1,l.loop&&h.play()},h.oncanplay=function(){l.videoW=h.videoWidth,l.videoH=h.videoHeight,l.canPlay=!0,!c&&r&&(c=!0,document.body.appendChild(h)),l.firstFrameRendered||l.update()}}get dataString(){return[this.playerW,this.playerH,this.video.src,Number(this.video.muted),Number(this.video.autoplay),Number(this.crop),Number(this.loop),this.fps].join(",")}static fromDataString(t){let e=t.split(","),i=new Ft(Number(e[0]),Number(e[1]),e[2],e[3]=="1",e[4]=="1");return i.crop=e[5]=="1",i.loop=e[6]=="1",i.fps=Number(e[7]),i}update(){if(this.playing||this.firstFrameRendered==!1){if(Math.abs(this.video.currentTime-this.oldTime)<1/this.fps)return;if(this.oldTime=this.video.currentTime,this.useBitmapData){var t,e=this.videoW,i=this.videoH,a=0,r=0,h=e,l=i,c=0,o=0,u=this.playerW,d=this.playerH;if(t=e/this.playerW,e*=t,i*=t,!this.crop)t=this.playerH/i,e*=t,i*=t,e>this.playerW&&(t=this.playerW/e,e*=t,i*=t),c=(this.playerW-e)*.5,o=(this.playerH-i)*.5,u=this.playerW-c*2,d=this.playerH-o*2;else{t=this.playerW/e,e*=t,i*=t,i<this.playerH&&(t=this.playerH/i,e*=t,i*=t);var v=e/this.videoW;a=(e-this.playerW)*.5/v,r=(i-this.playerH)*.5/v,h=this.videoW-a*2,l=this.videoH-r*2}this.context.drawImage(this.video,a,r,h,l,c,o,u,d),this.dispatchEvent(k.IMAGE_LOADED)}else createImageBitmap(this.video).then(p=>{this.bmp=p,this.dispatchEvent(k.IMAGE_LOADED)});return!0}}get htmlCanvas(){return this.useBitmapData?this.canvas:this.bmp?this.bmp:this.canvas}get useNativeBitmapData(){return this.useBitmapData}set useNativeBitmapData(t){this.useBitmapData!=t&&(t?(this.canvas.width=this.video.width,this.canvas.height=this.video.height):this.canvas.width=this.canvas.height=1,this.useBitmapData=t)}get ready(){return this.canPlay}get htmlVideo(){return this.video}play(){document.body.contains(this.video)||document.body.appendChild(this.video),this.video.play()}stop(){document.body.contains(this.video)&&document.body.removeChild(this.video),this.video.src=""}seekPercent(t){this.video.currentTime=this.duration*t}seekTime(t){this.video.currentTime=t}}class rt extends K{constructor(t,e=!0,i=!1){super();n(this,"source");n(this,"matrix");n(this,"dirty",!0);n(this,"dirtyMatrix",!0);n(this,"patternCanvas");n(this,"canvas");n(this,"center");n(this,"targetW");n(this,"targetH");n(this,"imageBmp",null);n(this,"rotationInDegree",0);n(this,"onImageLoaded");n(this,"_crop",!0);n(this,"_applyTargetScale",!1);this.source=t;var a=this;this.onImageLoaded=function(r){a.imageBmp=null,a.dirty=a.dirtyMatrix=!0},t.addEventListener(k.IMAGE_LOADED,this.onImageLoaded),this.canvas=t.htmlCanvas,this.matrix=new xt,this._crop=e,this._applyTargetScale=i}get crop(){return this._crop}set crop(t){this._crop!=t&&(this.dirty=this.dirtyMatrix=!0,this._crop=t)}get applyTargetScale(){return this._applyTargetScale}set applyTargetScale(t){this._applyTargetScale!=t&&(this.dirty=this.dirtyMatrix=!0,this._crop=t)}clone(t=!1,e=!0,i=!0,a=!0){var r;return t?this.source instanceof k?r=new rt(this.source.clone()):r=new rt(this.source):r=new rt(this.source),r.mat.x=this.matrix.x,r.mat.y=this.matrix.y,r.mat.scaleX=this.matrix.scaleX,r.mat.scaleY=this.matrix.scaleY,r.mat.rotation=this.matrix.rotation,r.mat.width=this.matrix.width,r.mat.height=this.matrix.height,r.mat.setMatrixValue(this.matrix.toString()),r.fillPathRule=this.fillPathRule,r.styleType=this.styleType,this.lineStyle&&(e?r.lineStyle=this.lineStyle.clone():r.lineStyle=this.lineStyle),this.textStyle&&(i?r.textStyle=this.textStyle.clone(a):r.textStyle=this.textStyle),r.alpha=this.alpha,r}get mat(){return this.matrix}get imageSource(){return this.source}set bitmapData(t){t!=this.source&&(this.source&&this.source instanceof k&&this.source.removeEventListener(k.IMAGE_LOADED,this.onImageLoaded),this.source=t,this.source.addEventListener(k.IMAGE_LOADED,this.onImageLoaded),this.canvas=this.source.htmlCanvas,this.dirty=!0)}get centerInto(){return this.center}set centerInto(t){t!=this.center&&(this.center=t,this.dirtyMatrix=!0)}get targetWidth(){return this.targetW}set targetWidth(t){t!=this.targetW&&(this.targetW=t,this.dirtyMatrix=!0)}get targetHeight(){return this.targetW}set targetHeight(t){t!=this.targetH&&(this.targetH=t,this.dirtyMatrix=!0)}get x(){return this.matrix.x}set x(t){this.x!=t&&(this.matrix.x=t,this.dirtyMatrix=!0)}get y(){return this.matrix.y}set y(t){this.y!=t&&(this.matrix.y=t,this.dirtyMatrix=!0)}get scaleX(){return this.matrix.scaleX}set scaleX(t){this.scaleX!=t&&(this.matrix.scaleX=t,this.dirtyMatrix=!0)}get scaleY(){return this.matrix.scaleY}set scaleY(t){this.scaleY!=t&&(this.matrix.scaleY=t,this.dirtyMatrix=!0)}get rotation(){return this.matrix.rotation}set rotation(t){this.rotation!=t&&(this.rotationInDegree=t,this.matrix.rotation=t,this.dirtyMatrix=!0)}apply(t,e,i){let a=this.canvas;if(this.source instanceof k?(a=this.source.htmlCanvas,this.source instanceof Ft&&(this.dirty=this.source.update())):a=this.source,this.dirty&&(this.patternCanvas=t.createPattern(a,"repeat"),this.dirty=!1),!this.patternCanvas)return;this.targetW=i.width,this.targetH=i.height;var r=a.width,h=a.height;let l=i.width*i.scaleX,c=i.height*i.scaleY;if(this.dirtyMatrix){this.matrix.identity();let u=1,d=1;this.applyTargetScale&&(u=i.scaleX,d=i.scaleY);let v=1,p=1;if(this.crop){let g=l/r;r*=g,h*=g,h<c&&(g=c/h,r*=g,h*=g),v=r/a.width,p=r/a.width,this.matrix.scale(v*i.inverseW/i.scaleX,p*i.inverseH/i.scaleY),this.matrix.translate(-((r-l)/v)*.5,-((h-c)/p)*.5),this.matrix.translate(r/v/2,h/p/2),this.matrix.scale(this.scaleX*u,this.scaleY*d),this.matrix.rotate(this.rotation/K.radian),this.matrix.translate(-(r/v)/2,-(h/p)/2),this.matrix.translate(this.x,this.y)}else this.matrix.scale(v*u*i.inverseW*this.scaleX,p*d*i.inverseH*this.scaleY),this.matrix.rotate(this.rotation/K.radian),this.matrix.translate(this.x,this.y);this.dirtyMatrix=!1}super.apply(t,e,i);let o=this.patternCanvas;o.setTransform(this.matrix.domMatrix),t[this.styleType]=o}}class ft extends rt{constructor(s,t=!0,e=!1){super(s,t,e),this.styleType="fillStyle"}get dataString(){var s=0,t=0;return this.crop&&(s=1),this.applyTargetScale&&(t=1),this.source.REGISTER_ID+","+s+","+t}static fromDataString(s){var t=s.split(",");return new ft(C.instance.getObjectByRegisterId(t[0]),t[1]=="1",t[1]=="1")}apply(s,t,e){super.apply(s,t,e),e.fillStrokeDrawable&&s.fill(t.path,this.fillPathRule)}}class ct extends K{constructor(t="#000000",e=null,i=null,a=null){super();n(this,"color");t instanceof B?this.color=t:this.color=new B(t,e,i,a)}clone(t=!1,e=!0,i=!0,a=!0){var r;return t?r=new ct(this.color.clone()):r=new ct(this.color),r.fillPathRule=this.fillPathRule,r.styleType=this.styleType,r.alpha=this.alpha,this.lineStyle&&(e?r.lineStyle=this.lineStyle.clone():r.lineStyle=this.lineStyle),this.textStyle&&(i?r.textStyle=this.textStyle.clone(a):r.textStyle=this.textStyle),r}apply(t,e,i){super.apply(t,e,i),t[this.styleType]=this.color.style}}class _t extends ct{constructor(s="#000000",t=null,e=null,i=null){super(s,t,e,i),this.styleType="fillStyle"}get dataString(){return this.color.REGISTER_ID}static fromDataString(s){return new _t(C.instance.getObjectByRegisterId(s))}apply(s,t,e){super.apply(s,t,e),e.fillStrokeDrawable&&s.fill(t.path,this.fillPathRule)}}class Q extends q{constructor(t=null){super();n(this,"cap",null);n(this,"dashOffset",null);n(this,"dashLineDist",null);n(this,"dashHoleDist",null);n(this,"join",null);n(this,"lineWidth",null);n(this,"miterLimit",null);n(this,"allowScaleTransform",!0);this.lineWidth=t}get dataString(){const t=[this.lineWidth,this.cap,this.dashOffset,this.dashLineDist,this.dashHoleDist,this.join,this.miterLimit,Number(this.allowScaleTransform)].join(",");return console.log("LineStyle get dataString = ",t),t}static fromDataString(t){var e=t.split(","),i=new Q(Number(e[0]));return e[1]!=""&&(i.cap=e[1]),e[2]!=""&&(i.dashOffset=Number(e[2])),e[3]!=""&&(i.dashLineDist=Number(e[3])),e[4]!=""&&(i.dashHoleDist=Number(e[4])),e[5]!=""&&(i.join=e[5]),e[6]!=""&&(i.miterLimit=Number(e[6])),i.allowScaleTransform=e[7]=="1",console.log("LineStyle fromDataString = ",i,e),i}clone(){var t=new Q(this.lineWidth);return t.cap=this.cap,t.dashOffset=this.dashOffset,t.dashHoleDist=this.dashHoleDist,t.dashLineDist=this.dashLineDist,t.join=this.join,t.miterLimit=this.miterLimit,t}apply(t,e,i){this.cap&&(t.lineCap=this.cap),this.join&&(t.lineJoin=this.join),this.lineWidth&&(t.lineWidth=this.lineWidth),this.miterLimit&&(t.miterLimit=this.miterLimit);let a=1,r=1;this.allowScaleTransform&&(a=i.scaleX,r=i.scaleY);let h=Math.max(i.width/a,i.height/r),l=Math.min(i.width,i.height);this.dashOffset&&(t.lineDashOffset=this.dashOffset),this.dashLineDist&&(this.dashHoleDist?t.setLineDash([this.dashLineDist/h,this.dashHoleDist/h]):t.setLineDash([this.dashLineDist/h])),t.lineWidth=this.lineWidth/l}}class pt extends ot{constructor(s,t=!0,e=null){super(s,t),this.styleType="strokeStyle",this.lineStyle=e||new Q(2)}get dataString(){var s=0;return this.isLinear&&(s=1),console.log("GradientStroke lineStyle = ",this.lineStyle),this.gradient.REGISTER_ID+","+s+","+(this.lineStyle?this.lineStyle.REGISTER_ID:"null")}static fromDataString(s){var t=s.split(",");return new pt(C.instance.getObjectByRegisterId(t[0]),t[1]=="1",C.instance.getObjectByRegisterId(t[2]))}apply(s,t,e){this.lineStyle&&this.lineStyle.apply(s,t,e),super.apply(s,t,e),e.fillStrokeDrawable&&s.stroke(t.path)}}class Xt extends rt{constructor(s,t=!0,e=!1,i=null){super(s,t,e),this.styleType="strokeStyle",this.lineStyle=i||new Q(2)}get dataString(){var s=0,t=0;return this.crop&&(s=1),this.applyTargetScale&&(t=1),this.source.REGISTER_ID+","+s+","+t+","+this.lineStyle.REGISTER_ID}static fromDataString(s){var t=s.split(",");return new Xt(C.instance.getObjectByRegisterId(t[0]),t[1]=="1",t[2]=="1",C.instance.getObjectByRegisterId(t[3]))}apply(s,t,e){this.lineStyle&&this.lineStyle.apply(s,t,e),super.apply(s,t,e),e.fillStrokeDrawable&&s.stroke(t.path)}}class bt extends ct{constructor(s="#000000",t=null,e=null,i=null,a=null){t instanceof Q&&(a=t,t=null),super(s,t,e,i),this.styleType="strokeStyle",a?this.lineStyle=a:this.lineStyle=new Q(2)}get dataString(){return this.color.REGISTER_ID+","+(this.lineStyle?this.lineStyle.REGISTER_ID:"null")}static fromDataString(s){const t=s.split(",");return new bt(C.instance.getObjectByRegisterId(t[0]),null,null,null,C.instance.getObjectByRegisterId(t[1]))}apply(s,t,e){this.lineStyle&&this.lineStyle.apply(s,t,e),super.apply(s,t,e),e.fillStrokeDrawable&&s.stroke(t.path)}}class Ot extends ot{constructor(s,t,e=!0){super(t,e),this.styleType="fillStyle",this.textStyle=s}get dataString(){var s=0;return this.isLinear&&(s=1),this.textStyle.REGISTER_ID+","+this.gradient.REGISTER_ID+","+s}static fromDataString(s){var t=s.split(",");return new Ot(C.instance.getObjectByRegisterId(t[0]),C.instance.getObjectByRegisterId(t[1]),t[2]=="1")}apply(s,t,e){this.textStyle.apply(s,t,e),super.apply(s,t,e),e.fillStrokeDrawable&&s.fillText(t.text,this.textStyle.offsetX/e.width,this.textStyle.offsetY/e.height)}}class Pt extends rt{constructor(s,t,e=!0,i=!1){super(t,e,i),this.styleType="fillStyle",this.textStyle=s}get dataString(){var s=0,t=0;return this.crop&&(s=1),this.applyTargetScale&&(t=1),this.textStyle.REGISTER_ID+","+this.source.REGISTER_ID+","+s+","+t}static fromDataString(s){var t=s.split(",");return new Pt(C.instance.getObjectByRegisterId(t[0]),C.instance.getObjectByRegisterId(t[1]),t[2]=="1",t[3]=="1")}apply(s,t,e){this.textStyle.apply(s,t,e),super.apply(s,t,e),e.fillStrokeDrawable&&s.fillText(t.text,this.textStyle.offsetX/e.width,this.textStyle.offsetY/e.height)}}class Bt extends ct{constructor(s,t="#000000",e=null,i=null,a=null){super(t,e,i,a),this.styleType="fillStyle",this.textStyle=s}get dataString(){return this.textStyle.REGISTER_ID+","+this.color.REGISTER_ID}static fromDataString(s){var t=s.split(",");return new Bt(C.instance.getObjectByRegisterId(t[0]),C.instance.getObjectByRegisterId(t[1]))}apply(s,t,e){this.textStyle.apply(s,t,e),super.apply(s,t,e),e.fillStrokeDrawable&&s.fillText(t.text,this.textStyle.offsetX/e.width,this.textStyle.offsetY/e.height)}}class kt extends ot{constructor(s,t,e=!0){super(t,e),this.styleType="strokeStyle",this.textStyle=s}get dataString(){var s=0;return this.isLinear&&(s=1),this.textStyle.REGISTER_ID+","+this.gradient.REGISTER_ID+","+s}static fromDataString(s){var t=s.split(",");return new kt(C.instance.getObjectByRegisterId(t[0]),C.instance.getObjectByRegisterId(t[1]),t[2]=="1")}apply(s,t,e){this.textStyle.apply(s,t,e),super.apply(s,t,e),e.fillStrokeDrawable&&s.strokeText(t.text,this.textStyle.offsetX/e.width,this.textStyle.offsetY/e.height)}}class Lt extends rt{constructor(s,t,e=!0,i=!1){super(t,e,i),this.styleType="strokeStyle",this.textStyle=s}get dataString(){var s=0,t=0;return this.crop&&(s=1),this.applyTargetScale&&(t=1),this.textStyle.REGISTER_ID+","+this.source.REGISTER_ID+","+s+","+t}static fromDataString(s){var t=s.split(",");return new Lt(C.instance.getObjectByRegisterId(t[0]),C.instance.getObjectByRegisterId(t[1]),t[2]=="1",t[3]=="1")}apply(s,t,e){this.textStyle.apply(s,t,e),super.apply(s,t,e),e.fillStrokeDrawable&&s.strokeText(t.text,this.textStyle.offsetX/e.width,this.textStyle.offsetY/e.height)}}class wt extends ct{constructor(s,t="#000000",e=null,i=null,a=null){super(t,e,i,a),this.styleType="strokeStyle",this.textStyle=s}get dataString(){return console.log("SolidTextStroke get dataString textStyle = ",this.textStyle),console.log("SolidTextStroke get dataString color = ",this.color),this.textStyle.REGISTER_ID+","+this.color.REGISTER_ID}static fromDataString(s){var t=s.split(",");return console.log("SolidTextStroke fromDataString textStyle  = ",C.instance.getObjectByRegisterId(t[0])),console.log("SolidTextStroke fromDataString color = ",C.instance.getObjectByRegisterId(t[1])),new wt(C.instance.getObjectByRegisterId(t[0]),C.instance.getObjectByRegisterId(t[1]))}apply(s,t,e){this.textStyle.apply(s,t,e),super.apply(s,t,e),e.fillStrokeDrawable&&s.strokeText(t.text,this.textStyle.offsetX/e.width,this.textStyle.offsetY/e.height)}}class Ut extends q{constructor(t,e,i,a,r){super();n(this,"x");n(this,"y");n(this,"w");n(this,"h");n(this,"renderStack");this.x=t,this.y=e,this.w=i,this.h=a,this.renderStack=r}get dataString(){return[this.x,this.y,this.w,this.h,this.renderStack.REGISTER_ID].join(",")}static fromDataString(t){var e=t.split(",");return new Ut(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3]),C.instance.getObjectByRegisterId(e[4]))}apply(t,e,i=Number.MAX_VALUE,a=Number.MAX_VALUE){t.save(),t.translate(this.x*e.inverseW,this.y*e.inverseH),t.scale(this.w/e.width,this.h/e.height);var r;return e.mouseEnabled?r=this.renderStack.updateWithHitTest(t,e,i,a,!0):r=this.renderStack.update(t,e,!0),t.restore(),r}}class Nt extends q{constructor(t,e=!0){super();n(this,"value");n(this,"enabled",!0);n(this,"mouseEnabled");n(this,"lastPath",null);n(this,"lastFillStroke",null);n(this,"isShape");n(this,"isPath");n(this,"isTextPath");n(this,"isPathFill");n(this,"isPathStroke");n(this,"isTextFill");n(this,"isTextStroke");n(this,"isTextFillStroke");n(this,"isPathFillStroke");n(this,"isStroke");this.value=t,this.mouseEnabled=e,this.isShape=this.value instanceof Ut,!this.isShape&&(this.isPath=this.value instanceof ht,this.isTextPath=this.value instanceof Et,!(this.isPath||this.isTextPath)&&(this.isPathFill=this.value instanceof _t||this.value instanceof Yt||this.value instanceof ft||this.value instanceof dt||this.value instanceof ee,this.isPathStroke=this.value instanceof bt||this.value instanceof pt||this.value instanceof Xt,this.isTextFill=this.value instanceof Bt||this.value instanceof Ot||this.value instanceof Pt,this.isTextStroke=this.value instanceof wt||this.value instanceof kt||this.value instanceof Lt,this.isTextFillStroke=this.value instanceof Bt||this.value instanceof Ot||this.value instanceof Pt||this.value instanceof wt||this.value instanceof kt||this.value instanceof Lt,this.isPathFillStroke=this.value instanceof bt||this.value instanceof pt||this.value instanceof Xt||this.value instanceof _t||this.value instanceof Yt||this.value instanceof ft||this.value instanceof dt,this.isStroke=this.isTextStroke||this.isPathStroke))}get dataString(){var t=0,e="0",i="0";return this.mouseEnabled&&(t=1),this.lastPath&&(e=this.lastPath.REGISTER_ID),this.lastFillStroke&&(i=this.lastFillStroke.REGISTER_ID),[this.value.REGISTER_ID,t,e,i,Number(this.enabled)].join(",")}static fromDataString(t){var e=t.split(","),i=new Nt(C.instance.getObjectByRegisterId(e[0]),e[1]=="1");return e[2]!="0"&&(i.lastPath=C.instance.getObjectByRegisterId(e[2])),e[3]!="0"&&(i.lastFillStroke=C.instance.getObjectByRegisterId(e[3])),i.enabled=e[4]=="1",i}clone(){var t=new Nt(this.value,this.mouseEnabled);return t.init(this.lastPath,this.lastFillStroke),t}init(t,e){this.lastPath=t,this.lastFillStroke=e}}class St extends q{constructor(){super();n(this,"lastPath");n(this,"lastFillStroke");n(this,"_elements");n(this,"offsetW",0);n(this,"offsetH",0);n(this,"mouse");this._elements=[]}get dataString(){var t="",e="0",i="0";this.lastPath&&(e=this.lastPath.REGISTER_ID),this.lastFillStroke&&(i=this.lastFillStroke.REGISTER_ID),t=e+","+i+"#";var a,r=this._elements.length;if(r==0)return"";for(a=0;a<r;a++)a>0&&(t+=","),t+=this._elements[a].REGISTER_ID;return t}static fromDataString(t){var e=t.split("#"),i=e[0].split(","),a=e[1].split(","),r,h=a.length,l=new St;for(r=0;r<h;r++)l.elements[r]=C.instance.getObjectByRegisterId(a[r]);return i[0]!="0"&&(l.lastPath=C.instance.getObjectByRegisterId(i[0])),i[1]!="0"&&(l.lastFillStroke=C.instance.getObjectByRegisterId(i[1])),l}get elements(){return this._elements}clone(){var t=new St,e,i=this.elements.length;for(e=0;e<i;e++)t.elements[e]=this.elements[e].clone();return t}push(t,e=!0){var i=new Nt(t,e);return this._elements.push(i),t instanceof ht||t instanceof Et?this.lastPath=t:t instanceof K&&(this.lastFillStroke=t),i.init(this.lastPath,this.lastFillStroke),i}updateWithHitTest(t,e,i=Number.MAX_VALUE,a=Number.MAX_VALUE,r=!1){let h,l,c=!1,o,u=this.elements.length,d;for(o=0;o<u;o++)h=this.elements[o],t.save(),h.enabled&&(h.isShape?(d=h.value.apply(t,e,i,a),c||(c=d)):h.isPath||h.isTextPath?l=h.value:(h.value.apply(t,l,e),!c&&h.mouseEnabled&&e.useComplexHitTest&&(c=l.isPointInside(t,i,a,h.isStroke)))),t.restore();return!r&&e.cacheAsBitmap&&(this.updateBounds(e),e.bitmapCache.draw(t,this.offsetW,this.offsetH)),e.mouseIsOver==!1&&c&&e.onMouseOver(),e.mouseIsOver&&c==!1&&e.onMouseOut(),c}update(t,e,i=!1){let a,r;if(i||e.cacheAsBitmap==!1){let h,l=this.elements.length;for(h=0;h<l;h++)a=this.elements[h],t.save(),a.enabled&&(a.isPath||a.isTextPath?r=a.value:a.value.apply(t,r,e)),t.restore()}else this.updateBounds(e),e.bitmapCache.draw(t,this.offsetW,this.offsetH);return!1}updateBounds(t){let e,i,a,r=0,h=0,l=0,c,o=this.elements.length;for(c=0;c<o;c++)e=this.elements[c],e.enabled&&(e.isPath?i=e.value:e.isTextPath?e.value:(a=e.value,a.offsetW>r&&(r=a.offsetW),a.offsetH>h&&(h=a.offsetH),a.lineWidth>l&&(l=a.lineWidth)));var u=i.geometry.getBounds(t,(r+l)*Math.sqrt(2),(h+l)*Math.sqrt(2));return this.offsetW=l+r*(Math.sqrt(2)+1),this.offsetH=l+h*(Math.sqrt(2)+1),u}updateCache(t,e){let i,a,r,h,l=this.elements.length;for(h=0;h<l;h++)i=this.elements[h],t.save(),i.enabled&&(i.isPath?a=i.value:i.isTextPath?r=i.value:i.isTextFillStroke?i.value.apply(t,r,e):i.value.apply(t,a,e)),t.restore()}}const V=class V extends xt{constructor(t,e,i){super();n(this,"cache");n(this,"_stage",null);n(this,"_cacheAsBitmap",!1);n(this,"renderStack");n(this,"width",1);n(this,"height",1);n(this,"alpha",1);n(this,"inverseW",1);n(this,"inverseH",1);n(this,"mouse",null);n(this,"mouseIsOver",!1);n(this,"mouseEnabled",!0);n(this,"useBasicHitTest",!1);n(this,"parent",null);n(this,"render",null);n(this,"currentTransform",null);n(this,"_bounds");n(this,"_display2dName");this._display2dName="o"+V.display2dIndex++,this.width=t,this.height=e,i?this.renderStack=i:this.renderStack=new St,this._bounds=new Qt(0,0,t,e),this.cache=new te(this)}get dataString(){var t=super.dataString;return t+="#",t+=[this.width,this.height,this.alpha,this.renderStack.REGISTER_ID].join(","),t}static fromDataString(t,e){var i=t.split("#")[2].split(","),a;return e?a=e:a=new V(Number(i[0]),Number(i[1]),C.instance.getObjectByRegisterId(i[3])),a.alpha=Number(i[2]),xt.fromDataString(t,a),a}get fillStrokeDrawable(){return this._cacheAsBitmap==!1||this.cache.needsUpdate==!0}get display2dName(){return this._display2dName}get useComplexHitTest(){return this.useBasicHitTest==!1&&this.mouseEnabled}setStage(t){this._stage=t,t?this.mouse=t.mouseControler:this.mouse=null}get stage(){return this._stage}align(t=H.CENTER){this.xAxis=this.width*t.x,this.yAxis=this.height*t.y}stack(t){return this.renderStack.push(t)}get cacheAsBitmap(){return this._cacheAsBitmap}set cacheAsBitmap(t){t!=this._cacheAsBitmap&&(this._cacheAsBitmap=t,t&&(this.cache.needsUpdate=!0))}get bitmapCache(){return this.cache}get bounds(){return this._bounds}get globalAlpha(){return this.parent?this.parent.globalAlpha*this.alpha:this.alpha}get globalX(){return this.parent?this.parent.globalX+this.x:this.x}get globalY(){return this.parent?this.parent.globalY+this.y:this.y}get globalScaleX(){return this.parent?this.parent.globalScaleX*this.scaleX:this.scaleX}get globalScaleY(){return this.parent?this.parent.globalScaleY*this.scaleY:this.scaleY}get globalRotation(){return this.parent?this.parent.globalRotation+this.rotation:this.rotation}onMouseOver(){this.mouseIsOver=!0,this.dispatchEvent(V.MOUSE_OVER)}onMouseOut(){this.mouseIsOver=!1,this.dispatchEvent(V.MOUSE_OUT)}resetBoundsOffsets(){this.offsetW=this.offsetH=0}update(t){this.identity(),this.inverseW=1/this.width,this.inverseH=1/this.height,t.save(),this.parent&&this.multiply(this.parent);let e=this.currentTransform=this.applyTransform();t.setTransform(e.a,e.b,e.c,e.d,e.e,e.f),this.cache.updateCache(),this.mouseEnabled&&this.mouse?this.renderStack.updateWithHitTest(t,this,this.mouse.x,this.mouse.y):this.renderStack.update(t,this),t.restore()}};n(V,"display2dIndex",0),n(V,"MOUSE_OVER","MOUSE_OVER"),n(V,"MOUSE_OUT","MOUSE_OUT"),n(V,"CLICK","CLICK"),n(V,"pathManager",new ht);let at=V;class It extends at{constructor(){super(1,1);n(this,"_numChildren",0);n(this,"_children");this._children=[]}get dataString(){var t=super.dataString;t+="#";var e,i=this._children.length;for(e=0;e<i;e++)e>0&&(t+=","),t+=this._children[e].REGISTER_ID;return t}static fromDataString(t,e){var i=t.split("#"),a=i[3].split(","),r;e?r=e:r=new It,at.fromDataString(t,r);var h,l=a.length;for(h=0;h<l;h++)r.appendChild(C.instance.getObjectByRegisterId(a[h]));return r}setStage(t){super.setStage(t);let e,i=this._numChildren;for(e=0;e<i;e++)this._children[e].setStage(t)}appendChild(t){return this._children[this._numChildren++]=t,t.parent=this,t.setStage(this.stage),t}removeChild(t){const e=this._children.lastIndexOf(t);return e<0?null:(this._children.splice(e,1),this._numChildren--,t.parent=null,this.setStage(null),t)}get numChildren(){return this._numChildren}get children(){return this._children}update(t){this.alpha;const e=this.parent,i=this.children;this.identity(),e&&this.multiply(e);const a=this.applyTransform();t.save();let r,h=this._numChildren;for(r=0;r<h;r++)i[r].update(t);return t.restore(),a}}class X{}n(X,"CLICK","CLICK"),n(X,"DOUBLE_CLICK","DOUBLE_CLICK"),n(X,"DOWN","DOWN"),n(X,"UP","UP"),n(X,"MOVE","MOVE"),n(X,"OVER","OVER"),n(X,"OUT","OUT"),n(X,"WHEEL_UP","WHEEL_UP"),n(X,"WHEEL_DOWN","WHEEL_DOWN");class ie extends Tt{constructor(t){super();n(this,"x",0);n(this,"y",0);n(this,"isDown",!1);n(this,"htmlCanvas");var e=this,i=this.htmlCanvas=t;i.onmouseover=function(a){e.getMouseXY(a),e.dispatchEvent(X.OVER)},i.onmouseout=function(a){e.getMouseXY(a),e.dispatchEvent(X.OUT)},i.onmousedown=function(a){e.getMouseXY(a),e.isDown=!0,e.dispatchEvent(X.DOWN)},i.onmouseup=function(a){e.getMouseXY(a),e.isDown=!1,e.dispatchEvent(X.UP)},i.onclick=function(a){e.getMouseXY(a),e.dispatchEvent(X.CLICK)},i.ondblclick=function(a){e.getMouseXY(a),e.dispatchEvent(X.DOUBLE_CLICK)},i.onmousemove=function(a){e.getMouseXY(a),e.dispatchEvent(X.MOVE)}}down(t,e){this.x=t,this.y=e,this.dispatchEvent(X.DOWN)}move(t,e){this.x=t,this.y=e,this.dispatchEvent(X.MOVE)}up(t,e){this.x=t,this.y=e,this.dispatchEvent(X.UP)}click(t,e){this.x=t,this.y=e,this.dispatchEvent(X.CLICK)}doubleClick(t,e){this.x=t,this.y=e,this.dispatchEvent(X.DOUBLE_CLICK)}getMouseXY(t){if(t&&t.preventDefault(),t=t||window.event,t.pageX==null&&t.clientX!=null){var e=document.documentElement,i=document.body;t.pageX=t.clientX+(e.scrollLeft||i&&i.scrollLeft||0),t.pageX-=e.clientLeft||0,t.pageY=t.clientY+(e.scrollTop||i&&i.scrollTop||0),t.pageY-=e.clientTop||0}this.x=t.pageX-this.htmlCanvas.offsetLeft,this.y=t.pageY-this.htmlCanvas.offsetTop}}class Kt extends It{constructor(t,e,i=!0){super();n(this,"_canvas");n(this,"_output");n(this,"_outputContext");n(this,"_context");n(this,"_mouseControler");this._stage=this,ut.canUseOffscreenCanvas?(this._canvas=new window.OffscreenCanvas(t,e),this._output=document.createElement("canvas"),this._output.style.position="absolute",ut.canUseImageBitmap?this._outputContext=this._output.getContext("bitmaprenderer"):this._outputContext=this._output.getContext("2d")):(this._canvas=document.createElement("canvas"),this._output=this._canvas,this._output.style.position="absolute",this._outputContext=this._output.getContext("2d")),this._canvas.width=this._output.width=t,this._canvas.height=this._output.height=e,this._context=this._canvas.getContext("2d"),this._mouseControler=new ie(this._output),i&&document.body.appendChild(this._output)}get dataString(){var t=super.dataString+"###"+this._canvas.width+","+this._canvas.height;return t}static fromDataString(t){var i=t.split("###"),e=i[1].split(",");t=i[0];var i=t.split("#")[2].split(","),a=new Kt(Number(e[0]),Number(e[1]),!0);return It.fromDataString(t,a),a}get canvas(){return this._canvas}get context(){return this._context}get mouseControler(){return this._mouseControler}get globalAlpha(){return this.alpha}get globalX(){return this.x}get globalY(){return this.y}get globalScaleX(){return this.scaleX}get globalScaleY(){return this.scaleY}get globalRotation(){return this.rotation}drawElements(){this._canvas.width=this._canvas.width,super.update(this._context),ut.canUseImageBitmap?createImageBitmap(this._canvas).then(t=>this._outputContext.transferFromImageBitmap(t)):this._outputContext.drawImage(this._canvas,0,0)}}class L extends U{constructor(t,e,i){super(t,e);n(this,"id");n(this,"dist",0);n(this,"next",null);n(this,"prev",null);n(this,"isQuadPoint",!1);this.id=i}clone(){return new L(this.x,this.y,this.id)}distanceTo(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)}distance(t,e){var i=t-this.x,a=e-this.y;return Math.sqrt(i*i+a*a)}angleTo(t){var e=t.x-this.x,i=t.y-this.y;return Math.atan2(i,e)}}class J{constructor(){n(this,"p1");n(this,"p2");n(this,"id");n(this,"d");n(this,"a");n(this,"x");n(this,"y")}reset(){this.p1=this.p2=null,this.id=this.d=this.a=this.x=this.y=0}}const st=class st{constructor(){n(this,"sourcePoints");n(this,"firstPt");n(this,"scale");n(this,"nbPointMax");n(this,"points");n(this,"width");n(this,"height");n(this,"minX");n(this,"minY");if(st._instance)throw new Error("You must use BorderVectorizer.instance");st._instance=this}static get instance(){return st._instance||new st,st._instance}init(s,t){return this.sourcePoints=t,this.nbPointMax=s,this.points=t.concat(),this.firstPt=t[0],this.process(),this.points}removeNearestPoints(s){var t,e=this.points;e.push(e[0]),e.push(e[1]);var i=Math.PI/180*s,a,r,h,l,c,o,u,d;for(t=2;t<e.length;t++)h=e[t-1].x,l=e[t-1].y,c=e[t].x,o=e[t].y,u=h-c,d=o-o,a=Math.atan2(d,u),u=e[t-2].x-h,d=e[t-2].y-l,r=Math.atan2(d,u),a-r<i&&e.splice(t,1);e.pop(),this.points=e}process(){var s=this.points.length,t=1,e=this.nbPointMax,i=0,a=1,r=-1,h=new J,l=new J,c=new J,o=[];o[0]=h,o[1]=l,o[2]=c;for(var u=this.points;s>e&&t<3;){if(i+=a,s>e){h.reset(),l.reset(),c.reset();let d=i,v=s-e,p,g,x,_,m,b,D,w,S,I=[],y,T,f,E,M,N,F,tt,z,Mt,Jt=0;for(x=2;x<u.length-1;x+=2)_=u[x-2],m=u[x-1],b=u[x],y=_.x,T=_.y,f=m.x,E=m.y,M=b.x,N=b.y,Mt=1e5,h.id=x-2,h.p1=_,h.p2=m,p=_.x-m.x,g=_.y-m.y,h.d=Math.sqrt(p*p+g*g)*Mt>>0,h.a=Math.atan2(g,p),l.id=x-1,l.p1=m,l.p2=b,p=m.x-b.x,g=m.y-b.y,l.d=Math.sqrt(p*p+g*g)*Mt>>0,l.a=Math.atan2(g,p),c.id=x,c.p1=b,c.p2=_,p=b.x-_.x,g=b.y-_.y,c.d=Math.sqrt(p*p+g*g)*Mt>>0,c.a=Math.atan2(g,p),o=o.sort(this.sortDist),z=o[2],D=z.p1,w=o[0].p1,S=o[0].id,w==z.p2&&(w=o[1].p1,S=o[1].id),p=D.x-w.x,g=D.y-w.y,F=Math.atan2(g,p),tt=Math.sqrt(p*p+g*g),w.x=D.x+Math.cos(-z.a+F)*tt>>0,w.y=D.y+Math.sin(-z.a+F)*tt>>0,g=Math.abs(w.y-D.y),_.x=y>>0,_.y=T>>0,m.x=f>>0,m.y=E>>0,b.x=M>>0,b.y=N>>0,g<d&&(I[Jt++]={d:g,id:S});for(I.length>v&&(I=I.sort(this.sortDist),I=I.slice(0,v)),I=I.sort(this.sortId),x=I.length-1;x>=0;x--)S=I[x].id,this.points.splice(S,1)}r=s,s=this.points.length,r==s?t++:t=0}}getBackOriginalScale(){this.minX=1e5;var s=0;this.minY=1e5;var t=0,e,i=0,a=this.sourcePoints.length,r;for(e=0;e<a;e++)r=this.sourcePoints[e],this.sourcePoints[e]!=null&&(r.x/=this.scale,r.y/=this.scale);this.points[0]==this.points[this.points.length-1]&&a--,a=this.points.length;var h=[];for(e=0;e<a;e++)this.points[e]!=null&&(r=this.points[e],h[i++]=new L(r.x,r.y,0),r.x<this.minX&&(this.minX=r.x),r.y<this.minY&&(this.minY=r.y),r.x>s&&(s=r.x),r.y>t&&(t=r.y));this.width=s-this.minX,this.height=t-this.minY;var l=h.concat();l[i-1]=this.firstPt,this.points=l}rescaleBorderBeforeSimplificationIfPictureIsTooSmall(s=0){var t=1e5,e=0,i=1e5,a=0,r,h=this.points.length,l;for(r=0;r<h;r++)l=this.points[r],l.x<t&&(t=l.x),l.y<i&&(i=l.y),l.x>e&&(e=l.x),l.y>a&&(a=l.y);var c=e-t,o=a-i,u=c*o;for(s?this.scale=s:this.scale=1e3*1e3/u,r=0;r<this.points.length;r++)this.points[r].x*=this.scale,this.points[r].y*=this.scale}removeSmallLines(s,t,e=9999){var i=[],a,r=0,h=this.points.length;t?i[r++]=this.points[0]:i[r++]=this.points[this.points.length-1];var l,c,o,u,d,v=0;if(t==!0)for(a=1;a<h;a++)l=this.points[a-1],c=this.points[a],o=l.x-c.x,u=l.y-c.y,d=Math.sqrt(o*o+u*u),v+d>s||r>=e?(i[r++]=c,v=(v+d-s)%s):v+=d;else for(a=h-2;a>-1;a--)l=this.points[a+1],c=this.points[a],o=l.x-c.x,u=l.y-c.y,d=Math.sqrt(o*o+u*u),v+d>s||r>=e?(i[r++]=c,v=(v+d-s)%s):v+=d;return this.points=i,i}removeNearLine(s,t=9999){var e,i,a,r,h,l,c=new J,o=new J,u=new J,d,v,p,g,x,_,m,b,D,w=[];w[0]=c,w[1]=o,w[2]=u;var S,I=0;for(a=2;a<this.points.length-1;a+=2){let E=function(M,N){return M.d>N.d?1:M.d<N.d?-1:0};r=this.points[a-2],h=this.points[a-1],l=this.points[a],g=r.x,x=r.y,_=h.x,m=h.y,b=l.x,D=l.y,S=1e5,c.id=a-2,c.p1=r,c.p2=h,e=r.x-h.x,i=r.y-h.y,c.d=Math.sqrt(e*e+i*i)*S>>0,c.a=Math.atan2(i,e),o.id=a-1,o.p1=h,o.p2=l,e=h.x-l.x,i=h.y-l.y,o.d=Math.sqrt(e*e+i*i)*S>>0,o.a=Math.atan2(i,e),u.id=a,u.p1=l,u.p2=r,e=l.x-r.x,i=l.y-r.y,u.d=Math.sqrt(e*e+i*i)*S>>0,u.a=Math.atan2(i,e),w=w.sort(E);var y=w[2];d=y.p1,v=w[0].p1,p=w[0].id,v==y.p2&&(v=w[1].p1,p=w[1].id),e=d.x-v.x,i=d.y-v.y;var T=Math.atan2(i,e),f=Math.sqrt(e*e+i*i);if(v.x=d.x+Math.cos(-y.a+T)*f>>0,v.y=d.y+Math.sin(-y.a+T)*f>>0,i=Math.abs(v.y-d.y),r.x=g>>0,r.y=x>>0,h.x=_>>0,h.y=m>>0,l.x=b>>0,l.y=D>>0,i<s&&(this.points.splice(p,1),I++,I==t))break}return this.points}sortDist(s,t){return s.d>t.d?1:s.d<t.d?-1:0}sortId(s,t){return s.id>t.id?1:s.id<t.id?-1:0}removeNearLine2(s,t=9999){var e,i,a,r,h,l,c=new J,o=new J,u=new J,d,v,p,g=[],x,_,m,b,D,w,S=[];S[0]=c,S[1]=o,S[2]=u;var I,y=0;for(a=2;a<this.points.length-1;a+=2){r=this.points[a-2],h=this.points[a-1],l=this.points[a],x=r.x,_=r.y,m=h.x,b=h.y,D=l.x,w=l.y,I=1e5,c.id=a-2,c.p1=r,c.p2=h,e=r.x-h.x,i=r.y-h.y,c.d=Math.sqrt(e*e+i*i)*I>>0,c.a=Math.atan2(i,e),o.id=a-1,o.p1=h,o.p2=l,e=h.x-l.x,i=h.y-l.y,o.d=Math.sqrt(e*e+i*i)*I>>0,o.a=Math.atan2(i,e),u.id=a,u.p1=l,u.p2=r,e=l.x-r.x,i=l.y-r.y,u.d=Math.sqrt(e*e+i*i)*I>>0,u.a=Math.atan2(i,e),S=S.sort(this.sortDist);var T=S[2];d=T.p1,v=S[0].p1,p=S[0].id,v==T.p2&&(v=S[1].p1,p=S[1].id),e=d.x-v.x,i=d.y-v.y;var f=Math.atan2(i,e),E=Math.sqrt(e*e+i*i);v.x=d.x+Math.cos(-T.a+f)*E>>0,v.y=d.y+Math.sin(-T.a+f)*E>>0,i=Math.abs(v.y-d.y),r.x=x>>0,r.y=_>>0,h.x=m>>0,h.y=b>>0,l.x=D>>0,l.y=w>>0,i<s&&(g[y++]={d:i,id:p})}for(g.length>t&&(g=g.sort(this.sortDist),g=g.slice(0,t)),g=g.sort(this.sortId),a=g.length-1;a>=0;a--)p=g[a].id,this.points.splice(p,1);return this.points}};n(st,"_instance");let Dt=st;class qt{constructor(){}static borderToCurve(s,t=10,e=null){var i=[],a,r=s.length;for(a=0;a<r;a++)i[a]=[s[a].x,s[a].y];return this.fitCurve(i,t,e)}static drawCurves(s,t){s.strokeStyle="#ff0000",s.beginPath();var e,i=t.length,a;for(e=0;e<i;e++)a=t[e],s.moveTo(a[0][0],a[0][1]),s.bezierCurveTo(a[1][0],a[1][1],a[2][0],a[2][1],a[3][0],a[3][1]);s.stroke()}static fitCurve(s,t=5,e=null){if(!Array.isArray(s))throw new TypeError("First argument should be an array");if(s.forEach(h=>{if(!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")throw Error("Each point should be an array of two numbers")}),s=s.filter((h,l)=>l===0||!(h[0]===s[l-1][0]&&h[1]===s[l-1][1])),s.length<2)return[];const i=s.length,a=this.createTangent(s[1],s[0]),r=this.createTangent(s[i-2],s[i-1]);return this.fitCubic(s,a,r,t,e)}static fitCubic(s,t,e,i,a){var h,l,c,o,u,d,v,p,g,x,_,m,b;if(s.length===2)return m=this.vectorLen(this.subtract(s[0],s[1]))/3,h=[s[0],this.addArrays(s[0],this.mulItems(t,m)),this.addArrays(s[1],this.mulItems(e,m)),s[1]],[h];if(l=this.chordLengthParameterize(s),[h,o,d]=this.generateAndReport(s,l,l,t,e,a),o<i)return[h];if(o<i*i)for(c=l,u=o,v=d,b=0;b<20;b++){if(c=this.reparameterize(h,s,c),[h,o,d]=this.generateAndReport(s,l,c,t,e,a),o<i)return[h];if(d===v){let D=o/u;if(D>.9999&&D<1.0001)break}u=o,v=d}return _=[],p=this.subtract(s[d-1],s[d+1]),p[0]===0&&p[1]===0&&(p=this.subtract(s[d-1],s[d]),[p[0],p[1]]=[-p[1],p[0]]),g=this.normalize(p),x=this.mulItems(g,-1),_=_.concat(this.fitCubic(s.slice(0,d+1),t,g,i,a)),_=_.concat(this.fitCubic(s.slice(d),x,e,i,a)),_}static generateAndReport(s,t,e,i,a,r){var h,l,c;return h=this.generateBezier(s,e,i,a,r),[l,c]=this.computeMaxError(s,h,t),r&&r({bez:h,points:s,params:t,maxErr:l,maxPoint:c}),[h,l,c]}static generateBezier(s,t,e,i,a){var r,h,l,c,o,u,d,v,p,g,x,_,m,b,D,w,S,I=s[0],y=s[s.length-1];for(r=[I,null,null,y],h=this.zeros_Xx2x2(t.length),m=0,b=t.length;m<b;m++)w=t[m],S=1-w,l=h[m],l[0]=this.mulItems(e,3*w*(S*S)),l[1]=this.mulItems(i,3*S*(w*w));for(c=[[0,0],[0,0]],o=[0,0],m=0,b=s.length;m<b;m++)w=t[m],l=h[m],c[0][0]+=this.dot(l[0],l[0]),c[0][1]+=this.dot(l[0],l[1]),c[1][0]+=this.dot(l[0],l[1]),c[1][1]+=this.dot(l[1],l[1]),D=this.subtract(s[m],this.q([I,I,y,y],w)),o[0]+=this.dot(l[0],D),o[1]+=this.dot(l[1],D);return u=c[0][0]*c[1][1]-c[1][0]*c[0][1],d=c[0][0]*o[1]-c[1][0]*o[0],v=o[0]*c[1][1]-o[1]*c[0][1],p=u===0?0:v/u,g=u===0?0:d/u,_=this.vectorLen(this.subtract(I,y)),x=1e-6*_,p<x||g<x?(r[1]=this.addArrays(I,this.mulItems(e,_/3)),r[2]=this.addArrays(y,this.mulItems(i,_/3))):(r[1]=this.addArrays(I,this.mulItems(e,p)),r[2]=this.addArrays(y,this.mulItems(i,g))),r}static reparameterize(s,t,e){return e.map((i,a)=>this.newtonRaphsonRootFind(s,t[a],i))}static newtonRaphsonRootFind(s,t,e){var i=this.subtract(this.q(s,e),t),a=this.qprime(s,e),r=this.mulMatrix(i,a),h=this.sum(this.squareItems(a))+2*this.mulMatrix(i,this.qprimeprime(s,e));return h===0?e:e-r/h}static chordLengthParameterize(s){var t=[],e,i,a;return s.forEach((r,h)=>{e=h?i+this.vectorLen(this.subtract(r,a)):0,t.push(e),i=e,a=r}),t=t.map(r=>r/i),t}static computeMaxError(s,t,e){var i,a,r,h,l,c,o,u;a=0,r=s.length/2;const d=this.mapTtoRelativeDistances(t,10);for(l=0,c=s.length;l<c;l++)o=s[l],u=this.find_t(t,e[l],d,10),h=this.subtract(this.q(t,u),o),i=h[0]*h[0]+h[1]*h[1],i>a&&(a=i,r=l);return[a,r]}static mapTtoRelativeDistances(s,t){for(var e,i=[0],a=s[0],r=0,h=1;h<=t;h++)e=this.q(s,h/t),r+=this.vectorLen(this.subtract(e,a)),i.push(r),a=e;return i=i.map(l=>l/r),i}static find_t(s,t,e,i){if(t<0)return 0;if(t>1)return 1;for(var a,r,h,l,c,o=1;o<=i;o++)if(t<=e[o]){l=(o-1)/i,h=o/i,r=e[o-1],a=e[o],c=(t-r)/(a-r)*(h-l)+l;break}return c}static createTangent(s,t){return this.normalize(this.subtract(s,t))}static zeros_Xx2x2(s){for(var t=[];s--;)t.push([0,0]);return t}static mulItems(s,t){return[s[0]*t,s[1]*t]}static mulMatrix(s,t){return s[0]*t[0]+s[1]*t[1]}static subtract(s,t){return[s[0]-t[0],s[1]-t[1]]}static addArrays(s,t){return[s[0]+t[0],s[1]+t[1]]}static addItems(s,t){return[s[0]+t,s[1]+t]}static sum(s){return s.reduce((t,e)=>t+e)}static dot(s,t){return this.mulMatrix(s,t)}static vectorLen(s){var t=s[0],e=s[1];return Math.sqrt(t*t+e*e)}static divItems(s,t){return[s[0]/t,s[1]/t]}static squareItems(s){var t=s[0],e=s[1];return[t*t,e*e]}static normalize(s){return this.divItems(s,this.vectorLen(s))}static q(s,t){var e=1-t,i=this.mulItems(s[0],e*e*e),a=this.mulItems(s[1],3*e*e*t),r=this.mulItems(s[2],3*e*t*t),h=this.mulItems(s[3],t*t*t);return this.addArrays(this.addArrays(i,a),this.addArrays(r,h))}static qprime(s,t){var e=1-t,i=this.mulItems(this.subtract(s[1],s[0]),3*e*e),a=this.mulItems(this.subtract(s[2],s[1]),6*e*t),r=this.mulItems(this.subtract(s[3],s[2]),3*t*t);return this.addArrays(this.addArrays(i,a),r)}static qprimeprime(s,t){return this.addArrays(this.mulItems(this.addArrays(this.subtract(s[2],this.mulItems(s[1],2)),s[0]),6*(1-t)),this.mulItems(this.addArrays(this.subtract(s[3],this.mulItems(s[2],2)),s[1]),6*t))}}const W=class W{constructor(){n(this,"borderPoints");n(this,"directions","");n(this,"bd");n(this,"center");n(this,"pt");n(this,"diago");n(this,"n");n(this,"tab");n(this,"count");n(this,"working");n(this,"firstId");n(this,"directionDatas");n(this,"offsetX");n(this,"offsetY");n(this,"_width");n(this,"bug");n(this,"pixelUsed");n(this,"radian",Math.PI/180);n(this,"trackCol");n(this,"holeBd");W._instance=this,this.diago=Math.sqrt(2);var s=W.offsetX=[],t=W.offsetY=[];s[0]=1,t[0]=-1,s[45]=1,t[45]=0,s[90]=1,t[90]=1,s[135]=0,t[135]=1,s[180]=-1,t[180]=1,s[225]=-1,t[225]=0,s[270]=-1,t[270]=-1,s[315]=0,t[315]=-1,s[360]=1,t[360]=-1,s[405]=1,t[405]=0,s[450]=1,t[450]=1,s[495]=0,t[495]=1,s[540]=-1,t[540]=1,s[585]=-1,t[585]=0,s[630]=-1,t[630]=-1,s[675]=0,t[675]=-1,s[720]=1,t[720]=-1,s[765]=1,t[765]=0}reset(){this.directionDatas=[],this.borderPoints=null,this.directions="",this.bd=null,this.center=null,this.pt=null,this.diago=null,this.n=null,this.tab=null,this.count=null,this.working=null,this.firstId=null,this.offsetX=null,this.offsetY=null,this._width=null,this.bug=null,this.pixelUsed=null,this.trackCol=null,this.holeBd=null}static get instance(){return W._instance||new W,W._instance}get holePicture(){return this.holeBd}getOutsideBorder(s){var t=s.getAlphaChannelBoundRect(0,0,s.width,s.height,0,0),e=new k(t.w,t.h,"rgba(0,0,0,0)");e.drawImage(s.htmlCanvas,t.x,t.y,t.w,t.h,0,0,t.w,t.h);var i=this.getBorderFromBitmapData(e,!1);if(i){let a,r=i.length;for(a=0;a<r;a++)i[a].x+=t.x,i[a].y+=t.y}return i}createGraphicsGeometryFromBitmapData(s,t=.2,e=1){var i=new Rt,a=this.getBorderFromBitmapData(s),r=Dt.instance.init(a.length*t>>0,a),h=qt.borderToCurve(r,e),l,c=h.length,o;for(l=0;l<c;l++)o=h[l],l==0&&i.moveTo(o[0][0],o[0][1]),i.bezierCurveTo(o[1][0],o[1][1],o[2][0],o[2][1],o[3][0],o[3][1]);return i}getBorderFromBitmapData(s,t=!1,e={r:255,g:0,b:255,a:0},i=null,a=!1,r=0,h=0){this.reset(),this.directions="";let l=this.tab=[];this.n=0,this.count=0,this.offsetX=W.offsetX,this.offsetY=W.offsetY;let c=t,o=this.trackCol=e;var u=s.width*s.height;i&&(u=i.w*i.h);var d=300*300/u;d<1?d=1:d>2&&(d=2),a&&(d+=1);var v=s.width*d>>0,p=s.height*d>>0;this.bd?this.bd.resize(v+4,p+4):this.bd=new k(v+4,p+4,"rgba(0,0,0,0)");let g=this.bd;g.drawImage(s.htmlCanvas,0,0,s.width,s.height,2,2,v,p),this.pixelUsed=[];let x=this.pixelUsed;var _,m=g.width*g.height;for(_=0;_<m;_++)x[_]=!1;var b=g.width>>1,D=2,w;if(c==!1)for(w=g.getAlphaChannelBoundRect(0,0,g.width,g.height,0,0),m=w.w+1,b=w.x-1,D=w.y+w.w/2>>0,_=0;_<w.w&&g.getPixelAlpha(b,D)==0;_++)b++;else for(w=g.getColorBoundRect(0,0,g.width,g.height,o.r,o.g,o.b,o.a),m=w.w+1,b=w.x,D=w.y,_=0;_<m&&!g.matchColor(b,D,o.r,o.g,o.b,o.a);_++)b++;l=this.tab=[],this.directions="",this.count=0,this.center=new L(b,D,0);let S=this.pt=new L(b-1,D,0),I=this.firstId=D*g.width+b>>0;if(x[I]=!0,this._width=g.width,this.bug=!1,this.working=!0,c==!1)for(;this.working&&this.bug==!1;)this.getBorder(),this.bug=this.count>100;else for(;this.working&&this.bug==!1;)this.getBorderColorTracking(),this.bug=this.count>100;if(this.borderPoints=null,this.bug==!0){if(a==!0||c)return null;var y=s.clone();return y.applyFilter("blur(0.05px)"),this.getBorderFromBitmapData(y,c,o,i,!0)}m=l.length;var T=l[l.length-1];for(_=0;_<m;_++)S=l[_],S.x=r+S.x/d>>0,S.y=h+S.y/d>>0,S.id=_,S.prev=T,T.next=S,T=S;return this.borderPoints=l,l}returnAngle(s,t){return Math.atan2(t.y-s.y,t.x-s.x)/(Math.PI/180)>>0}getBorder(){let t=this.returnAngle(this.center,this.pt)+45,e=t+315,i=0,a=0,r,h=!1,l,c=this.center,o=this.pixelUsed,u=this._width,d=this.bd,v=this.directionDatas,p=this.firstId,g=this.tab,x=this.offsetX,_=this.offsetY;for(;t<e;){if(i=c.x+x[t+135],a=c.y+_[t+135],l=a*u+i,d.getPixelAlpha(i,a)!=0){if(o[l]==!0){if(l==p){h=!1,this.working=!1,this.count=0;break}}else if(!o[l]){this.directions+=v[t+45],o[l]=!0,g.push(new L(i,a,this.n++)),h=!0;break}}t+=45}if(h)r=new L(c.x,c.y,0),this.center=new L(i,a,0),this.pt=new L(r.x,r.y,0),this.count=0;else{c=new L(this.pt.x,this.pt.y,0),this.count++;var m=g.length-this.count;m>=0?this.pt=g[m]:this.working=!1}}getBorderColorTracking(){let t=this.returnAngle(this.center,this.pt)+45,e=t+450,i,a=0,r=0,h,l=!1,c,o=this.radian,u=this.center,d=this.pixelUsed,v=this.diago,p=this._width,g=this.bd,x=this.directionDatas,_=this.firstId,m=this.tab,b=this.trackCol.r,D=this.trackCol.g,w=this.trackCol.b,S=this.trackCol.a;for(;t<e;){if(i=o*t,t%45!=0?(a=u.x+Math.cos(i)*v>>0,r=u.y+Math.sin(i)*v>>0):(a=u.x+Math.cos(i)>>0,r=u.y+Math.sin(i)>>0),c=r*p+a,g.matchColor(a,r,b,D,w,S)){if(d[c]==!0){if(c==_){l=!1,this.working=!1,this.count=0;break}}else if(!d[c]){this.directions+=x[t+45],d[c]=!0,m.push(new L(a,r,this.n++)),l=!0;break}}t+=45}if(l)h=new L(u.x,u.y,0),this.center=new L(a,r,0),this.pt=new L(h.x,h.y,0),this.count=0;else{u=new L(this.pt.x,this.pt.y,0),this.count++;var I=m.length-this.count;I>=0?this.pt=m[I]:this.working=!1}}getNumberOfHoles(s){for(var t=s.clone(),e=t.getAlphaChannelBoundRect(0,0,t.width,t.height,0,0),i,a,r={r:100,g:0,b:255,a:255},h=0,l=s.width,c=s.height;e!=null&&e.w!=0&&e.h!=0;){for(a=e.w,i=0;i<a;i++)if(t.matchAlpha(e.x+i,e.y,0)){var o=t.floodFillRGBA(e.x+i,e.y,r.r,r.g,r.b,r.a).bounds;r.g=Math.random()*255>>0,r.b=Math.random()*255>>0,r.r=Math.random()*255>>0,o.x>0&&o.y>0&&o.x+o.width<l&&o.y+o.height<c&&h++;break}e=t.getAlphaChannelBoundRect(0,0,t.width,t.height,0,0)}return console.log("nbHole = ",h),h}getHoleBorders(s){var t=[],e=s,i=e.getAlphaChannelBoundRect(0,0,e.width,e.height,0,0),u,a,r={r:255,g:0,b:255,a:255};r.g=Math.random()*255>>0,r.b=Math.random()*255>>0,r.r=Math.random()*255>>0;for(var h=0,l=s.width,c=s.height,o;i!=null&&i.w!=0&&i.h!=0;){for(a=i.w,u=0;u<a;u++)if(e.matchAlpha(i.x+u,i.y,0)){o=e.floodFillRGBAandReturnOutputCanvas(i.x+u,i.y,r.r,r.g,r.b,r.a),o.offsetX>0&&o.offsetY>0&&o.offsetX+o.width<l-1&&o.offsetY+o.height<c-1&&(t[h++]=o),r.g=Math.random()*255>>0,r.b=Math.random()*255>>0,r.r=Math.random()*255>>0;break}i=e.getAlphaChannelBoundRect(0,0,e.width,e.height,0,0)}var u,d=[];for(u=0;u<t.length;u++)o=t[u],o.offsetX,o.offsetY,d[u]=this.getBorderFromBitmapData(o,!1,{r:0,g:0,b:0,a:0},null,!1,o.offsetX,o.offsetY);return d}debugBorder(s,t,e="#000000",i=!0,a=0,r=0){if(s.strokeStyle=s.fillStyle=e,s.beginPath(),s.moveTo(t[0].x+a,t[0].y+r),i)for(var h=1;h<t.length;h++)s.lineTo(t[h].x+a,t[h].y+r);else for(var h=t.length-1;h>=0;h--)s.lineTo(t[h].x+a,t[h].y+r);s.stroke()}};n(W,"_instance"),n(W,"offsetX"),n(W,"offsetY");let At=W;class se extends ht{constructor(t,e=.055,i=1){super();n(this,"_outsideBitmap",null);n(this,"_holeBitmap",null);n(this,"_outsideVector",null);n(this,"_holeVector",null);n(this,"_outsideCurves",null);n(this,"_holeCurves",null);n(this,"bd");n(this,"precision");n(this,"curveSmooth");this.bd=t,this.precision=e,this.curveSmooth=i,this.updateBitmapBorders(),this.generatePath()}updateBitmapBorders(){this.bd.saveData(),this.bd.setPadding(1,1,1,1),this._outsideBitmap=At.instance.getBorderFromBitmapData(this.bd),this._holeBitmap=At.instance.getHoleBorders(this.bd);for(var t=0;t<this._holeBitmap.length;t++)this._holeBitmap[t]=this._holeBitmap[t].reverse();this.bd.restoreData(),this.vectorize(this.precision),this.curveSmooth!=0&&this.convertLinesToCurves(this.curveSmooth)}vectorize(t=.055){if(!(!this._outsideBitmap||!this._holeBitmap)){t>1&&(t=1),t<1e-4&&(t=1e-4);var e=t*2;this._outsideVector=Dt.instance.init(this._outsideBitmap.length*t>>0,this._outsideBitmap),this._holeVector=[];var i,a=this._holeBitmap.length;for(i=0;i<a;i++)this._holeVector[i]=Dt.instance.init(this._holeBitmap[i].length*e>>0,this._holeBitmap[i])}}convertLinesToCurves(t=1){if(this._holeVector){t<.1&&(t=.1),this.outsideVector||this.vectorize(.065),this._outsideCurves=qt.borderToCurve(this.outsideVector,t),this._holeCurves=[];var e,i=this._holeVector.length;for(e=0;e<i;e++)this._holeCurves[e]=qt.borderToCurve(this._holeVector[e],t)}}generatePath(){let t,e;if(this.outsideCurves){if(this.drawCurves(this.outsideCurves),this.holeCurves&&this.holeCurves.length)for(e=this.holeCurves.length,t=0;t<e;t++)this.drawCurves(this.holeCurves[t])}else if(this.outsideVector){if(this.drawLines(this.outsideVector),this.holeVector&&this.holeVector.length)for(e=this.holeVector.length,t=0;t<e;t++)this.drawLines(this.holeVector[t])}else if(this.drawLines(this.outsideBitmap),this.holeBitmap&&this.holeBitmap.length)for(e=this.holeBitmap.length,t=0;t<e;t++)this.drawLines(this.holeBitmap[t]);this.computePath()}drawLines(t){if(!t)return;this.moveTo(t[0].x,t[0].y);let e,i=t.length;for(e=1;e<i;e++)this.lineTo(t[e].x,t[e].y)}drawCurves(t){if(!t)return;let e,i=t.length,a;for(e=0;e<i;e++)a=t[e],e==0&&this.moveTo(a[0][0],a[0][1]),this.bezierCurveTo(a[1][0],a[1][1],a[2][0],a[2][1],a[3][0],a[3][1])}get outsideBitmap(){return this._outsideBitmap}get holeBitmap(){return this._holeBitmap}get outsideVector(){return this._outsideVector}get holeVector(){return this._holeVector}get outsideCurves(){return this._outsideCurves}get holeCurves(){return this._holeCurves}}const Z=class Z extends ht{constructor(){if(super(),!Z._instance)Z._instance=this;else throw new Error("CirclePath is a singleton. You must use CirclePath.instance.");this.circle(.5,.5,.5),this.computePath()}static get instance(){return Z._instance||new Z,Z._instance}static get path(){return Z.instance.path}};n(Z,"_instance");let zt=Z;const $=class $ extends ht{constructor(){if(super(),!$._instance)$._instance=this;else throw new Error("SquarePath is a singleton. You must use SquarePath.instance.");this.rect(0,0,1,1),this.computePath()}static get instance(){return $._instance||new $,$._instance}static get path(){return $.instance.path}};n($,"_instance");let Gt=$;class Ct extends k{constructor(t=""){super();n(this,"_img");n(this,"_url","");n(this,"onLoaded");var e=this,i=this._img=document.createElement("img");i.onload=function(){e.width=i.width,e.height=i.height,e.drawImage(i,0,0),e.onLoaded&&e.onLoaded(i),e.dispatchEvent(Ct.IMAGE_LOADED)},this.url=t}get dataString(){return this.url}static fromDataString(t){return new Ct(t)}get htmlImage(){return this._img}get url(){return this._url}set url(t){t!=this._url&&(this._url=this._img.src=t)}}class jt extends q{constructor(t,e,i="px",a=0,r=0,h=!1,l=null){super();n(this,"fontName");n(this,"fontSize");n(this,"sizeMeasure","px");n(this,"offsetX",0);n(this,"offsetY",0);n(this,"lineStyle",null);n(this,"allowScaleTransform",!1);this.fontName=t,this.fontSize=e,this.sizeMeasure=i,this.offsetX=a+e*.2,this.offsetY=r+e*.85,this.allowScaleTransform=h,this.lineStyle=l}get dataString(){return[this.fontName,this.fontSize,this.sizeMeasure,this.offsetX,this.offsetY,Number(this.allowScaleTransform),this.lineStyle?this.lineStyle.REGISTER_ID:"null"].join(",")}static fromDataString(t){let e=t.split(",");return new jt(e[0],Number(e[1]),e[2],Number(e[3]),Number(e[4]),e[5]=="1",C.instance.getObjectByRegisterId(e[6]))}clone(t=!0){let e=null;this.lineStyle&&(t?e=this.lineStyle.clone():e=this.lineStyle);let i=new jt(this.fontName,this.fontSize,this.sizeMeasure,this.offsetX,this.offsetY);return i.lineStyle=e,i}apply(t,e,i){var a=Math.max(i.width,i.height);this.lineStyle&&this.lineStyle.apply(t,e,i),t.font=this.fontSize/a+this.sizeMeasure+" "+this.fontName,this.allowScaleTransform==!1&&t.scale(1/i.scaleX,1/i.scaleY)}}class ae extends q{constructor(){super();n(this,"____eventStack");n(this,"dirty",!0);this.____eventStack=[]}addDirtyEventTarget(t){this.____eventStack.lastIndexOf(t)==-1&&this.____eventStack.push(t)}removeDirtyEventTarget(t){const e=this.____eventStack.lastIndexOf(t);e!=-1&&this.____eventStack.splice(e,1)}applyDirty(){let t,e=this.____eventStack.length;for(t=0;t<e;t++)this.____eventStack[t].dirty=!0}}class re extends ae{constructor(){super();n(this,"boundOffsetW",0);n(this,"boundOffsetH",0);n(this,"next",null);n(this,"_updateColor");n(this,"_color");n(this,"_offsetX",0);n(this,"_offsetY",0);n(this,"_radius",0);n(this,"_intensity",0);n(this,"_angle",0);var t=this;this._updateColor=function(){t.dirty=!0,t.applyDirty()}}get value(){return null}get angle(){return this._angle}set angle(t){t!=this._angle&&(this._angle=t)}get color(){return this._color}set color(t){t!=this._color&&(this._color&&this._color.removeEventListener(B.UPDATE_STYLE,this._updateColor),this._color=t,this._color.addEventListener(B.UPDATE_STYLE,this._updateColor),this.applyDirty())}get intensity(){return this._intensity}set intensity(t){t!=this._intensity&&(this._intensity=t,this.applyDirty())}get offsetX(){return this._offsetX}set offsetX(t){t!=this._offsetX&&(this._offsetX=t,this.boundOffsetW=Math.abs(t)+this.radius,this.applyDirty())}get offsetY(){return this._offsetX}set offsetY(t){t!=this._offsetY&&(this._offsetY=t,this.boundOffsetH=Math.abs(t)+this.radius,this.applyDirty())}get radius(){return this._radius}set radius(t){t!=this._radius&&(this._radius=t,this.boundOffsetW=Math.abs(this._offsetX)+t,this.boundOffsetH=Math.abs(this._offsetY)+t,this.applyDirty())}clear(){for(var t in this)this[t]=null}}class gt extends re{constructor(s,t,e,i){super(),this.offsetX=s,this.offsetY=t,this.radius=e,i instanceof B?this.color=i:this.color=new B(i)}get dataString(){return[this.offsetX,this.offsetY,this.radius,this.color.REGISTER_ID].join(",")}static fromDataString(s){var t=s.split(",");return new gt(Number(t[0]),Number(t[1]),Number(t[2]),C.instance.getObjectByRegisterId(t[3]))}clone(s=!1){return s?new gt(this._offsetX,this._offsetY,this._radius,this._color.clone()):new gt(this._offsetX,this._offsetY,this._radius,this._color)}get value(){return"drop-shadow("+this._offsetX+"px "+this._offsetY+"px "+this._radius+"px "+this._color.style+") "}}class mt extends gt{constructor(s,t){super(0,0,s,t)}get dataString(){return this.radius+","+this.color.REGISTER_ID}static fromDataString(s){var t=s.split(",");return new mt(Number(t[0]),C.instance.getObjectByRegisterId(t[1]))}clone(s=!1){return s?new mt(this._radius,this._color.clone()):new mt(this._radius,this._color)}}class Wt extends q{constructor(){super();n(this,"first");n(this,"last");n(this,"_value");n(this,"dirty",!0);n(this,"boundOffsetW",0);n(this,"boundOffsetH",0)}clear(){let t=this.first;for(;t;)t.clear(),t=t.next}clone(t=!1){let e=this.first;const i=new Wt;for(;e;)t?i.add(e.clone()):i.add(e);return i}get value(){if(this.dirty){let t="",e=this.first,i=0,a=0;for(;e;)t=t+e.value+" ",e.boundOffsetW>i&&(i=e.boundOffsetW),e.boundOffsetH>a&&(a=e.boundOffsetH),e=e.next;this.boundOffsetW=i,this.boundOffsetH=a,this._value=t,this.dirty=!1}return this._value}get dataString(){for(var t="",e=this.first,i=!1;e;)i&&(t+=","),t+=e.REGISTER_ID,i=!0,e=e.next;return t}static fromDataString(t){var e=t.split(","),i=new Wt,a,r=e.length;for(a=0;a<r;a++)i.add(C.instance.getObjectByRegisterId(e[a]));return i}add(t){return this.first||(this.first=t),this.last&&(this.last.next=t),this.last=t,t.addDirtyEventTarget(this),this}}class he{constructor(){const s=new Kt(window.innerWidth,window.innerHeight),t=new It;t.x=300,t.y=0,t.rotation=25,s.appendChild(t);const e=new B(13369344),i=new yt([e,new B(16711680)],null,!0),a=new Ct("assets/mire.jpg"),r=new Ft(1920*.5,1080*.5,"assets/video.webm"),h=new pt(i),l=new Q(15),c=new Ct("assets/alpha.png");c.addEventListener(k.IMAGE_LOADED,function(){const I=new se(c),y=new at(400,500);y.x=-200;const T=!1,f=new yt([new B(255),e,new B(16711680)],null,T);y.stack(I),y.stack(new bt(e,l)),y.stack(new pt(f,T,l)),y.stack(new ft(r)),t.appendChild(y)});const o=new jt("Arial",100,"px");o.lineStyle=new Q(3);const u=new wt(o,e),d=new mt(25,"#ff0000"),v=new Wt().add(d),p=new ft(a,!0,!1);p.filters=v;const g=h.lineStyle=new Q;g.lineWidth=10,g.dashLineDist=30,g.dashHoleDist=30,g.cap="round",g.join="round";const x=new St;x.push(Gt.instance),x.push(new _t(e));const _=new Ut(50,450,50,100,x),m=new at(400,400);m.stack(zt.instance),m.stack(p),m.stack(h);const b=m.stack(new Et("Hello Canvas !"));m.stack(u),m.stack(_),m.align(H.CENTER),m.x=200,m.y=200,m.rotation=50,t.appendChild(m),m.addEventListener(at.MOUSE_OVER,function(I){I.alpha=.5}),m.addEventListener(at.MOUSE_OUT,function(I){I.alpha=1}),document.body.onclick=function(){m.cacheAsBitmap=!m.cacheAsBitmap};let D=0;const w="Hello Canvas !";function S(){D+=.01;const I=Math.sin(D*2.5);b.value.text="Hello Canvas ! ".slice(0,Math.round(w.length*Math.abs(I))),l.lineWidth=Math.abs(Math.cos(D))*15,e.g=127+Math.abs(I*100),e.b=255-Math.abs(I*255),d.radius=25+50*Math.sin(I*Math.PI*.2),g.dashLineDist=25+I*15,g.dashHoleDist=20+(1-I)*5,m.x=400+Math.sin(D)*150,h.rotation+=.01,p.rotation-=.0025,p.scaleX=p.scaleY=1+Math.abs(Math.sin(D)*.5),p.x=Math.sin(D*Math.PI)*100,s.drawElements(),requestAnimationFrame(S)}S()}}new he;
